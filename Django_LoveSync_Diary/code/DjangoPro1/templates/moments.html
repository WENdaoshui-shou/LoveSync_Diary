<!DOCTYPE html>
<html lang = "zh-CN" >

<head >
    <meta charset = "UTF-8" >
    <meta name = "viewport" content = "width=device-width, initial-scale=1.0" >
    <title >我的动态 - LoveSync</title >
    <script src = "https://cdn.tailwindcss.com" ></script >
    <link href = "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel = "stylesheet" >
    <link href = "https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
          rel = "stylesheet" >
    <script >
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B8B', // 爱情粉色作为主色调
                        secondary: '#722ED1', // 紫色作为辅助色
                        neutral: {
                            100: '#F9F9F9',
                            200: '#F0F0F0',
                            300: '#E0E0E0',
                            400: '#BDBDBD',
                            500: '#9E9E9E',
                            600: '#757575',
                            700: '#616161',
                            800: '#424242',
                            900: '#212121',
                        }
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': {opacity: '0'},
                            '100%': {opacity: '1'},
                        },
                        slideUp: {
                            '0%': {transform: 'translateY(20px)', opacity: '0'},
                            '100%': {transform: 'translateY(0)', opacity: '1'},
                        }
                    }
                },
            }
        }
    </script >
    <style type = "text/tailwindcss" >
        @layer utilities {
            .transition-custom {
                transition: all 0.3s ease;
            }
    
            .hover-scale {
                transition: transform 0.3s ease;
            }
    
            .hover-scale:hover {
                transform: scale(1.02);
            }
    
            .bg-gradient-love {
                background: linear-gradient(135deg, #FF6B8B 0%, #722ED1 100%);
            }
    
            .self-badge {
                position: relative;
            }
    
            .self-badge::after {
                content: '我';
                position: absolute;
                bottom: -5px;
                right: -5px;
                background-color: #FF6B8B;
                color: white;
                border-radius: 50%;
                width: 16px;
                height: 16px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 10px;
                font-weight: bold;
            }
        }
    </style >
</head >

<body
        class = "font-inter bg-neutral-100 text-neutral-800 min-h-screen flex flex-col overflow-x-hidden relative scroll-smooth" >
    <!-- 背景装饰元素 -->
    <div class = "absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none" >
        <div class = "absolute -top-40 -left-40 w-80 h-80 bg-primary/10 rounded-full filter blur-3xl float-animation" >
        </div >
        <div class = "absolute -bottom-20 -right-20 w-80 h-80 bg-secondary/10 rounded-full filter blur-3xl float-animation"
             style = "animation-delay: -2s;" ></div >
        <div class = "absolute top-1/3 right-1/4 w-40 h-40 bg-primary/5 rounded-full filter blur-2xl float-animation"
             style = "animation-delay: -4s;" ></div >
    </div >

    <!-- 导航栏 -->
    <header class = "fixed w-full top-0 z-50 transition-all duration-300 bg-white/95 backdrop-blur-md shadow-sm py-3" >
        <div class = "container mx-auto px-4 flex items-center justify-between" >
            <!-- 品牌标识 -->
            <a href = "{% url 'index' %}" class = "flex items-center space-x-2" >
                <div
                        class = "w-10 h-10 rounded-full bg-gradient-love flex items-center justify-center text-white shadow-md" >
                    <i class = "fa-solid fa-heart text-xl" ></i >
                </div >
                <span class = "text-xl font-bold text-neutral-800 tracking-tight" >LoveSync</span >
            </a >
            <!-- 桌面端导航菜单 -->
            <nav class = "hidden md:flex items-center space-x-6" >
                <a href = "{% url 'community' %}"
                   class = "text-neutral-700 hover:text-primary transition-custom font-medium px-1 py-2 border-b-2 border-transparent hover:border-primary" >爱享公社</a >
                <a href = "{% url 'moments' %}"
                   class = "text-neutral-700 hover:text-primary transition-custom font-medium px-1 py-2 border-b-2 border-transparent hover:border-primary" >心动轨迹</a >
                <a href = "{% url 'photo_album' %}"
                   class = "text-neutral-700 hover:text-primary transition-custom font-medium px-1 py-2 border-b-2 border-transparent hover:border-primary" >心跳相簿</a >
                <a href = "{% url 'lovesync' %}"
                   class = "text-neutral-700 hover:text-primary transition-custom font-medium px-1 py-2 border-b-2 border-transparent hover:border-primary" >双人日记</a >
    
                <!-- 更多下拉菜单 -->
                <div class = "relative" id = "moreDropdown" >
                    <button
                            class = "text-neutral-700 hover:text-primary transition-custom font-medium flex items-center px-1 py-2"
                            id = "moreButton" >
                        更多 <i class = "fa-solid fa-chevron-down ml-1 text-xs" ></i >
                    </button >
                    <div class = "absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl py-2 z-50 hidden"
                         id = "moreOptions" >
                        <a href = "{% url 'couple' %}"
                           class = "block px-4 py-2 text-neutral-700 hover:bg-neutral-50 transition-custom flex items-center" >
                            <i class = "fa-solid fa-calendar-heart mr-2 w-5 text-center" ></i >情侣设置
                        </a >
                        <a href = "#"
                           class = "block px-4 py-2 text-neutral-700 hover:bg-neutral-50 transition-custom flex items-center" >
                            <i class = "fa-solid fa-gift mr-2 w-5 text-center" ></i >礼物推荐
                        </a >
                        <a href = "#"
                           class = "block px-4 py-2 text-neutral-700 hover:bg-neutral-50 transition-custom flex items-center" >
                            <i class = "fa-solid fa-map-marker-heart mr-2 w-5 text-center" ></i >情侣地点
                        </a >
                        <a href = "#"
                           class = "block px-4 py-2 text-neutral-700 hover:bg-neutral-50 transition-custom flex items-center" >
                            <i class = "fa-solid fa-question-circle mr-2 w-5 text-center" ></i >爱情测试
                        </a >
                    </div >
                </div >
            </nav >

            <!-- 内容过滤器 -->
            <div
                    class = "bg-white/95 backdrop-blur-md rounded-xl shadow-lg p-2 flex justify-between items-center hover-scale" >
                <div class = "flex space-x-2" >
                    <button class = "px-4 py-2 rounded-full bg-primary text-white text-sm font-medium" >
                        推荐
                    </button >
                    <button
                            class = "px-4 py-2 rounded-full bg-neutral-100 text-neutral-700 text-sm font-medium hover:bg-neutral-200 transition-custom" >
                        最新
                    </button >
                    <button
                            class = "px-4 py-2 rounded-full bg-neutral-100 text-neutral-700 text-sm font-medium hover:bg-neutral-200 transition-custom" >
                        热门
                    </button >
                </div >
                <div class = "relative" >
                    <input type = "text" placeholder = "LoveSync: 搜索..."
                           class = "pl-10 pr-4 py-2 rounded-full border border-neutral-200 focus:outline-none focus:ring-2 focus:ring-primary/50 form-input-focus text-sm" >
                    <i class = "fa-solid fa-search absolute left-4 top-1/2 -translate-y-1/2 text-neutral-400" ></i >
                </div >
            </div >

            <!-- 用户操作区 -->
            <div class = "flex items-center space-x-4" >
                <a href = "{% url 'moments' %}" id = "createPostLink"
                   class = "hidden md:flex items-center space-x-2 px-5 py-2 rounded-full bg-gradient-love text-white hover:opacity-90 transition-custom shadow-md hover:shadow-lg" >
                    <i class = "fa-solid fa-pencil" ></i >
                    <span >发布动态</span >
                </a >
    
                <!-- 用户头像与下拉菜单 -->
                <div class = "relative" id = "userDropdown" >
                    <div class = "w-10 h-10 rounded-full overflow-hidden border-2 border-primary cursor-pointer shadow-sm"
                         id = "userAvatar" >
                        <img src = "{{ user.profile.userAvatar.url }}" alt = "用户头像"
                             class = "w-full h-full object-cover" >
                    </div >
                    <div class = "absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl py-2 z-50 hidden"
                         id = "userOptions" >
                        <a href = "{% url 'personal_center' %}"
                           class = "block px-4 py-2 text-neutral-700 hover:bg-neutral-50 transition-custom flex items-center" >
                            <i class = "fa-solid fa-user mr-2 w-5 text-center" ></i >主页
                        </a >
                        <a href = "{% url 'message' %}"
                           class = "block px-4 py-2 text-neutral-700 hover:bg-neutral-50 transition-custom flex items-center" >
                            <i class = "fa-solid fa-bookmark mr-2 w-5 text-center" ></i >消息
                        </a >
                        <a href = "{% url 'settings' %}"
                           class = "block px-4 py-2 text-neutral-700 hover:bg-neutral-50 transition-custom flex items-center" >
                            <i class = "fa-solid fa-cog mr-2 w-5 text-center" ></i >设置
                        </a >
                        <div class = "border-t border-neutral-200 my-1" ></div >
                        <a href = "{% url 'logout' %}"
                           class = "block px-4 py-2 text-red-500 hover:bg-red-50 transition-custom flex items-center" >
                            <i class = "fa-solid fa-sign-out mr-2 w-5 text-center" ></i >退出登录
                        </a >
                    </div >
                </div >
    
                <!-- 移动端菜单按钮 -->
                <button class = "md:hidden text-neutral-700 focus:outline-none" id = "menu-toggle" >
                    <i class = "fa-solid fa-bars text-xl" ></i >
                </button >
            </div >
        </div >
    
        <!-- 移动端菜单 -->
        <div id = "mobile-menu"
             class = "hidden md:hidden bg-white shadow-lg absolute w-full transform -translate-y-2 opacity-0 transition-all duration-200 ease-in-out"
             style = "top: 100%;" >
            <div class = "container mx-auto px-4 py-3 flex flex-col space-y-3" >
                <a href = "{% url 'community' %}"
                   class = "text-neutral-700 hover:text-primary py-2 transition-custom font-medium flex items-center" >
                    <i class = "fa-solid fa-users mr-3 w-5 text-center" ></i >爱享公社
                </a >
                <a href = "{% url 'moments' %}"
                   class = "text-neutral-700 hover:text-primary py-2 transition-custom font-medium flex items-center" >
                    <i class = "fa-solid fa-bolt mr-3 w-5 text-center" ></i >心动轨迹
                </a >
                <a href = "{% url 'photo_album' %}"
                   class = "text-neutral-700 hover:text-primary py-2 transition-custom font-medium flex items-center" >
                    <i class = "fa-solid fa-images mr-3 w-5 text-center" ></i >心跳相簿
                </a >
                <a href = "{% url 'lovesync' %}"
                   class = "text-neutral-700 hover:text-primary py-2 transition-custom font-medium flex items-center" >
                    <i class = "fa-solid fa-bookmark mr-3 w-5 text-center" ></i >双人日记
                </a >
                <div class = "border-t border-neutral-200 my-1" ></div >
                <a href = "#" class = "text-neutral-700 py-2 transition-custom flex items-center" >
                    <i class = "fa-solid fa-calendar-heart mr-3 w-5 text-center" ></i >纪念日提醒
                </a >
                <a href = "#" class = "text-neutral-700 py-2 transition-custom flex items-center" >
                    <i class = "fa-solid fa-gift mr-3 w-5 text-center" ></i >礼物推荐
                </a >
                <a href = "#" class = "text-neutral-700 py-2 transition-custom flex items-center" >
                    <i class = "fa-solid fa-map-marker-heart mr-3 w-5 text-center" ></i >情侣地点
                </a >
                <a href = "#" class = "text-neutral-700 py-2 transition-custom flex items-center" >
                    <i class = "fa-solid fa-question-circle mr-3 w-5 text-center" ></i >爱情测试
                </a >
                <div class = "border-t border-neutral-200 my-1" ></div >
                <a href = "{% url 'personal_center' %}"
                   class = "text-neutral-700 py-2 transition-custom flex items-center" >
                    <i class = "fa-solid fa-user mr-3 w-5 text-center" ></i >主页
                </a >
                <a href = "{% url 'message' %}" class = "text-neutral-700 py-2 transition-custom flex items-center" >
                    <i class = "fa-solid fa-bookmark mr-3 w-5 text-center" ></i >消息
                </a >
                <a href = "{% url 'message' %}" class = "text-neutral-700 py-2 transition-custom flex items-center" >
                    <i class = "fa-solid fa-cog mr-3 w-5 text-center" ></i >设置
                </a >
                <div class = "border-t border-neutral-200 my-1" ></div >
                <a href = "{% url 'logout' %}" class = "text-red-500 py-2 transition-custom flex items-center" >
                    <i class = "fa-solid fa-sign-out mr-3 w-5 text-center" ></i >退出登录
                </a >
            </div >
        </div >
    </header >

    <!-- 主内容区 -->
    <main class = "flex-grow pt-24 pb-16 relative z-10" >
        <div class = "container mx-auto px-4" >
            <!-- 个人信息头部 -->
            <div class = "bg-white rounded-xl shadow-lg p-6 mb-8 animate-fade-in" >
                <div class = "flex flex-col md:flex-row items-center" >
                    <div
                            class = "w-20 h-20 rounded-full overflow-hidden mb-4 md:mb-0 md:mr-6 border-4 border-primary/20 self-badge" >
                        <img src = "{{ user.profile.userAvatar.url }}" alt = "用户头像"
                             class = "w-full h-full object-cover" >
                    </div >
                    <div class = "text-center md:text-left" >
                        <h2 class = "text-2xl font-bold text-neutral-800 mb-1" >{{ user.name }}</h2 >
                        <p class = "text-neutral-600 mb-1" >分享我们的爱情故事</p >
                        <p class = "text-neutral-700 mb-3 text-sm italic" >"你是我的今天和所有的明天"</p >
                        <div class = "flex flex-wrap justify-center md:justify-start gap-4" >
                            <div class = "text-center" >
                                <p class = "text-2xl font-bold text-primary" >{{ moments.count }}</p >
                                <p class = "text-neutral-500 text-sm" >动态</p >
                            </div >
                            <div class = "text-center" >
                                <p class = "text-2xl font-bold text-primary" >189</p >
                                <p class = "text-neutral-500 text-sm" >粉丝</p >
                            </div >
                            <div class = "text-center" >
                                <p class = "text-2xl font-bold text-primary" >342</p >
                                <p class = "text-neutral-500 text-sm" >关注</p >
                            </div >
                        </div >
                    </div >
                </div >
            </div >

            <!-- 发布动态表单 -->
            <div class = "bg-white rounded-xl shadow-lg p-6 mb-8 animate-slide-up" >
                <h3 class = "text-xl font-semibold text-neutral-800 mb-4" >分享你的此刻</h3 >
                {% if error %}
                    <div class = "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4" >
                        {{ error }}
                    </div >
                {% endif %}
                <form id = "postForm" method = "POST" enctype = "multipart/form-data" action = "{% url 'moments' %}" >
                    {% csrf_token %}

                    <!-- 动态内容 -->
                    <div class = "mb-4" >
                        <textarea id = "postContent" rows = "4" name = "content"
                                  class = "w-full px-4 py-3 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-custom"
                                  placeholder = "分享你们的甜蜜瞬间..." ></textarea >
                    </div >

                    <!--标签 -->
                    <div class = "flex flex-wrap gap-4 mb-4" >
                        <div class = "flex items-center space-x-2" >
                            <input type = "checkbox" id = "tag-travel" name = "tags" value = "旅行"
                                   class = "w-4 h-4 text-primary focus:ring-primary border-neutral-300 rounded" >
                            <label for = "tag-travel" class = "text-sm text-neutral-700" >旅行</label >
                        </div >
                        <div class = "flex items-center space-x-2" >
                            <input type = "checkbox" id = "tag-food" name = "tags" value = "美食"
                                   class = "w-4 h-4 text-primary focus:ring-primary border-neutral-300 rounded" >
                            <label for = "tag-food" class = "text-sm text-neutral-700" >美食</label >
                        </div >
                        <div class = "flex items-center space-x-2" >
                            <input type = "checkbox" id = "tag-anniversary" name = "tags" value = "纪念日"
                                   class = "w-4 h-4 text-primary focus:ring-primary border-neutral-300 rounded" >
                            <label for = "tag-anniversary" class = "text-sm text-neutral-700" >纪念日</label >
                        </div >
                        <div class = "flex items-center space-x-2" >
                            <input type = "checkbox" id = "tag-daily" name = "tags" value = "日常"
                                   class = "w-4 h-4 text-primary focus:ring-primary border-neutral-300 rounded" >
                            <label for = "tag-daily" class = "text-sm text-neutral-700" >日常</label >
                        </div >
                        <div class = "flex items-center space-x-2" >
                            <input type = "checkbox" id = "tag-gift" name = "tags" value = "礼物"
                                   class = "w-4 h-4 text-primary focus:ring-primary border-neutral-300 rounded" >
                            <label for = "tag-gift" class = "text-sm text-neutral-700" >礼物</label >
                        </div >
                    </div >

                    <div class = "flex flex-wrap items-center justify-between gap-4" >
                        <div class = "flex items-center space-x-4" >
                            <label for = "image" class = "cursor-pointer" >
                                <i class = "fa-solid fa-image text-primary text-xl" ></i >
                                <span class = "text-sm text-neutral-700 ml-1" >添加图片</span >
                                <input type = "file" name = "image" id = "image" class = "hidden" accept = "image/*"
                                       multiple >
                            </label >
    
                            <!-- 预览图片位置-->
                            <div class = "mt-4 grid grid-cols-2 gap-2" id = "image-preview" ></div >
                        </div >
                        <button type = "submit"
                                class = "px-6 py-2 bg-gradient-love text-white rounded-lg hover:opacity-90 transition-custom shadow-md hover:shadow-lg flex items-center" >
                            <i class = "fa-solid fa-paper-plane mr-2" ></i >
                            <span >发布动态</span >
                        </button >
                    </div >
                </form >
            </div >

            <!-- 动态列表 -->
            <div class = "space-y-6" >
                {% for moment in moments %}
                <!-- 动态1 -->
                    <div class = "bg-white rounded-xl shadow-lg overflow-hidden post-card animate-fade-in"
                         style = "animation-delay: 0.1s" >
                    <div class = "p-6" >
                        <!-- 用户信息 -->
                        <div class = "flex items-center justify-between" >
                            <div class = "flex items-center space-x-3" >
                                <div class = "w-10 h-10 rounded-full overflow-hidden self-badge" >
                                    <img src = "{{ moment.user.profile.userAvatar.url }}" alt = "用户头像"
                                         class = "w-full h-full object-cover" >
                                </div >

                                <div >
                                    <h4 class = "font-semibold text-neutral-900" >{{ moment.user.name }}</h4 >
                                    <p class = "text-neutral-500 text-xs" >{{ moment.created_at|timesince }}前</p >

                                    <div class = "flex flex-wrap gap-2 mt-3" >
                                        {% for tag in moment.tags.all %}
                                            <span class = "px-2 py-1 text-xs font-medium text-primary bg-primary/20 rounded-full" >
                                                {{ tag.name }}
                                            </span >
                                        {% endfor %}
                                    </div >

                                </div >
                            </div >
                            <div class = "flex items-center justify-between" >
                            <div class = "flex items-center space-x-3" >
                                <!-- 用户头像和名称 -->
                            </div >
                            <div class = "relative" >
                                <button class = "text-neutral-400 hover:text-neutral-700 transition-custom"
                                        id = "moreBtn-{{ moment.id }}" >
                                    <i class = "fa-solid fa-ellipsis-h" ></i >
                                </button >
                                <div class = "absolute right-0 mt-2 w-40 bg-white rounded-lg shadow-lg py-2 z-50 hidden"
                                     id = "menu-{{ moment.id }}" >
                                    {% if moment.is_shared %}
                                        <a href = "#"
                                           class = "block px-4 py-2 text-yellow-500 hover:bg-yellow-50 transition-custom unshare-btn"
                                           data-moment-id = "{{ moment.id }}" >
                                            <i class = "fa-solid fa-undo mr-2" ></i > 取消分享
                                        </a >
                                    {% else %}
                                        <a href = "#"
                                           class = "block px-4 py-2
                                           {% if moment.is_shared %}
                                              text-gray-400 cursor-not-allowed opacity-50
                                           {% else %}
                                              text-blue-500 hover:bg-blue-50 transition-custom share-btn
                                           {% endif %}"
                                           data-moment-id = "{{ moment.id }}"
                                           data-is-shared = "{{ moment.is_shared|lower }}" >
                                            <i class = "fa-solid fa-{% if moment.is_shared %}check{% else %}share-alt{% endif %} mr-2" ></i >
                                            {% if moment.is_shared %}已分享{% else %}分享到社区{% endif %}
                                        </a >
                                    {% endif %}
                                    <a href = "#"
                                       class = "block px-4 py-2 text-red-500 hover:bg-red-50 transition-custom delete-btn"
                                       data-moment-id = "{{ moment.id }}" >
                                            <i class = "fa-solid fa-trash-can mr-2" ></i > 删除动态
                                        </a >
                                </div >
                            </div >
    
                                <!-- 分享确认弹窗 -->
                            <div id = "share-confirm-modal"
                                 class = "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden" >
                                <div class = "bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 p-6 transform transition-all" >
                                    <h3 class = "text-lg font-semibold text-gray-800 mb-4" >确认分享</h3 >
                                    <p class = "text-gray-600 mb-6" >你确定要将这条动态分享到社区吗？</p >
                                    <div class = "flex justify-end space-x-3" >
                                        <button id = "cancel-share-btn"
                                                class = "px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-custom" >
                                            取消
                                        </button >
                                        <button id = "confirm-share-btn"
                                                class = "px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-custom" >
                                            <i class = "fa fa-share-alt mr-2" ></i >分享
                                        </button >
                                    </div >
                                </div >
                            </div >
    
                                <!-- 删除确认模态框 -->
                            <div id = "delete-modal"
                                 class = "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden" >
                                <div class = "bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 p-6 transform transition-all" >
                                    <h3 class = "text-lg font-semibold text-gray-800 mb-4" >确认删除</h3 >
                                    <p class = "text-gray-600 mb-6" >你确定要删除这条动态吗？此操作不可撤销。</p >
                                    <div class = "flex justify-end space-x-3" >
                                        <button id = "cancel-delete-btn"
                                                class = "px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-custom" >
                                            取消
                                        </button >
                                        <button id = "confirm-delete-btn"
                                                class = "px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-custom" >
                                            <i class = "fa fa-trash mr-2" ></i >删除
                                        </button >
                                    </div >
                                </div >
                            </div >
    
                                <!-- 取消分享确认模态框 -->
                            <div id = "unshare-modal"
                                 class = "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden" >
                                <div class = "bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 p-6 transform transition-all" >
                                    <h3 class = "text-lg font-semibold text-gray-800 mb-4" >确认取消分享</h3 >
                                    <p class = "text-gray-600 mb-6" >你确定要取消这条动态的分享吗？它将不再显示在社区中。</p >
                                    <div class = "flex justify-end space-x-3" >
                                        <button id = "cancel-unshare-btn"
                                                class = "px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-custom" >
                                            取消
                                        </button >
                                        <button id = "confirm-unshare-btn"
                                                class = "px-4 py-2 bg-yellow-500 text-white rounded-md hover:bg-yellow-600 transition-custom" >
                                            <i class = "fa fa-undo mr-2" ></i >取消分享
                                        </button >
                                    </div >
                                </div >
                            </div >
                        </div >
                        </div >

                        <!-- 动态内容 -->
                        <div class = "mt-4" >
                            <p class = "text-neutral-800" >{{ moment.content }}</p >
                        </div >

                        <!-- 动态图片 -->
                        <div class = "mt-4 grid gap-2
                                    sm:grid-cols-2
                                    md:grid-cols-3
                                    lg:grid-cols-4" >
                            {% for image in moment.moment_images.all %}
                                <img src = "{{ image.image.url }}" alt = "动态图片"
                                     class = "rounded-lg w-full h-40 object-cover hover-scale" >
                            {% endfor %}
                        </div >

                        <!-- 点赞评论数 -->
                        <div class = "mt-4 flex justify-between items-center" >
                            <div class = "flex space-x-4" >
                                <button
                                        class = "flex items-center space-x-1 text-neutral-500 hover:text-primary transition-custom like-btn" >
                                    <i class = "fa-regular fa-heart" ></i >
                                    <span >{{ moment.likes }}</span >
                                </button >
                                <button
                                        class = "flex items-center space-x-1 text-neutral-500 hover:text-primary transition-custom comment-btn" >
                                    <i class = "fa-regular fa-comment" ></i >
                                    <span >{{ moment.comments }}</span >
                                </button >
                            </div >
                        </div >
                    </div >
                    </div >
                {% endfor %}
            </div >
        </div >
    </main >

    <!-- 页脚 -->
    <footer class = "bg-white border-t border-neutral-200 py-8" >
        <div class = "container mx-auto px-4" >
            <div class = "flex flex-col md:flex-row justify-between items-center" >
                <div class = "flex items-center space-x-2" >
                    <div class = "w-8 h-8 bg-gradient-love rounded-full text-white" >
                        <i class = "fa-solid fa-heart" ></i >
                    </div >
                    <span class = "text-lg font-bold" >LoveSync</span >
                </div >
                <div class = "text-neutral-500 text-sm" >
                    &copy; 2023 LoveSync. 我们的故事，正在动态里持续更新。
                </div >
            </div >
        </div >
    </footer >

    <!-- 交互逻辑 -->
    <script >
    // 获取CSRF令牌
    function getCSRFToken() {
        const cookieValue = document.cookie.match('(^|;)\\s*csrftoken\\s*=\\s*([^;]+)');
        return cookieValue ? cookieValue.pop() : '';
    }

    // 封装模态框操作函数
    function setupModal(modalId, openBtnsClass, closeBtnId, confirmBtnId, confirmCallback) {
        const modal = document.getElementById(modalId);
        const openBtns = document.querySelectorAll(openBtnsClass);
        const closeBtn = document.getElementById(closeBtnId);
        const confirmBtn = document.getElementById(confirmBtnId);
    
        let currentId = null;
    
        // 打开模态框
        openBtns.forEach(btn => {
            btn.addEventListener('click', function (e) {
                e.preventDefault();
                currentId = this.getAttribute('data-moment-id');
            
                // 显示模态框并添加动画
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.querySelector('div').classList.add('scale-100');
                    modal.querySelector('div').classList.remove('scale-95', 'opacity-0');
                }, 10);
            });
        });
    
        // 关闭模态框
        closeBtn.addEventListener('click', function () {
            modal.querySelector('div').classList.remove('scale-100');
            modal.querySelector('div').classList.add('scale-95', 'opacity-0');
        
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 500);
        });
    
        // 确认操作
        confirmBtn.addEventListener('click', function () {
            if (!currentId) return;
        
            // 显示加载状态
            this.disabled = true;
            this.innerHTML = this.innerHTML.replace(/[^\s]+/, '<i class="fa fa-spinner fa-spin mr-2"></i>');
        
            // 执行回调函数
            confirmCallback(currentId, this, modal);
        });
    
        return {
            getCurrentId: () => currentId
        };
    }

    document.addEventListener('DOMContentLoaded', () => {
        // 移动端菜单切换
        const menuToggle = document.getElementById('menu-toggle');
        const mobileMenu = document.getElementById('mobile-menu');
    
        menuToggle.addEventListener('click', function () {
            if (mobileMenu.classList.contains('hidden')) {
                mobileMenu.classList.remove('hidden');
                setTimeout(() => {
                    mobileMenu.classList.add('translate-y-0', 'opacity-100');
                }, 50);
            } else {
                mobileMenu.classList.remove('translate-y-0', 'opacity-100');
                setTimeout(() => {
                    mobileMenu.classList.add('hidden');
                }, 200);
            }
        });
    
        // 发布动态表单提交
        const postForm = document.getElementById('postForm');
        if (postForm) {
            postForm.addEventListener('submit', function (e) {
                e.preventDefault();
            
                const content = document.getElementById('postContent').value;
                if (!content.trim()) {
                    alert('请输入动态内容');
                    return;
                }
            
                this.submit();
            
                // 清空表单
                document.getElementById('postContent').value = '';
            
                // 清空标签选择
                const checkboxes = document.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
            
                // 清空文件选择
                document.getElementById('image').value = '';
                document.getElementById('image-preview').innerHTML = '';
            });
        }
    
        // 预览上传图片
        const imageInput = document.getElementById('image');
        if (imageInput) {
            imageInput.addEventListener('change', function (e) {
                const previewContainer = document.getElementById('image-preview');
                previewContainer.innerHTML = ''; // 清空旧预览
            
                const files = e.target.files;
                for (const file of files) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.className = "rounded-lg w-full h-40 object-cover hover-scale";
                    previewContainer.appendChild(img);
                }
            });
        }
    
        // 设置分享功能
        setupModal(
                'share-confirm-modal',
                '.share-btn:not(.opacity-50)',
                'cancel-share-btn',
                'confirm-share-btn',
                (momentId, btn, modal) => {
                    fetch(`/share-moment/${momentId}/`, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': getCSRFToken()
                        }
                    })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    // 更新UI
                                    const momentCard = document.querySelector(`[data-moment-id="${momentId}"]`).closest('.post-card');
                                    const shareBtn = momentCard.querySelector('.share-btn');
                                
                                    shareBtn.classList.remove('text-blue-500', 'hover:bg-blue-50', 'share-btn');
                                    shareBtn.classList.add('text-gray-400', 'cursor-not-allowed', 'opacity-50');
                                    shareBtn.innerHTML = '<i class="fa-solid fa-check mr-2"></i> 已分享';
                                
                                    // 更新data属性
                                    shareBtn.setAttribute('data-is-shared', 'true');
                                
                                    // 更新菜单中的按钮
                                    const menuBtn = momentCard.querySelector(`[data-moment-id="${momentId}"]`);
                                    menuBtn.classList.remove('share-btn');
                                    menuBtn.classList.add('unshare-btn');
                                    menuBtn.classList.remove('text-blue-500', 'hover:bg-blue-50');
                                    menuBtn.classList.add('text-yellow-500', 'hover:bg-yellow-50');
                                    menuBtn.innerHTML = '<i class="fa-solid fa-undo mr-2"></i> 取消分享';
                                
                                    modal.classList.add('hidden');
                                } else {
                                    alert(data.error || '分享失败，请重试');
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('网络错误，请重试');
                            })
                            .finally(() => {
                                btn.disabled = false;
                                btn.innerHTML = '<i class="fa fa-share-alt mr-2"></i>分享';
                            });
                }
        );
    
    
        // 设置删除功能
        setupModal(
                'delete-modal',
                '.delete-btn',
                'cancel-delete-btn',
                'confirm-delete-btn',
                (momentId, btn, modal) => {
                    fetch(`/moments/${momentId}/delete/`, {
                        method: 'DELETE',
                        headers: {
                            'X-CSRFToken': getCSRFToken()
                        }
                    })
                            .then(response => {
                                if (response.ok) {
                                    // 从DOM中移除动态卡片
                                    const momentCard = document.querySelector(`[data-moment-id="${momentId}"]`).closest('.post-card');
                                    momentCard.classList.add('opacity-0');
                                
                                    setTimeout(() => {
                                        momentCard.remove();
                                        modal.classList.add('hidden');
                                    }, 300);
                                } else {
                                    throw new Error('删除失败');
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('删除失败，请重试');
                            })
                            .finally(() => {
                                btn.disabled = false;
                                btn.innerHTML = '<i class="fa fa-trash mr-2"></i>删除';
                            });
                }
        );
    
        // 设置取消分享功能
        setupModal(
                'unshare-modal',
                '.unshare-btn',
                'cancel-unshare-btn',
                'confirm-unshare-btn',
                (momentId, btn, modal) => {
                    fetch(`/unshare-moment/${momentId}/`, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': getCSRFToken()
                        }
                    })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    // 更新UI
                                    const momentCard = document.querySelector(`[data-moment-id="${momentId}"]`).closest('.post-card');
                                    const unshareBtn = momentCard.querySelector('.unshare-btn');
                                
                                    // 切换按钮状态
                                    unshareBtn.classList.remove('text-yellow-500', 'hover:bg-yellow-50', 'unshare-btn');
                                    unshareBtn.classList.add('text-blue-500', 'hover:bg-blue-50', 'share-btn');
                                    unshareBtn.innerHTML = '<i class="fa-solid fa-share-alt mr-2"></i> 分享到社区';
                                
                                    // 更新data属性
                                    unshareBtn.setAttribute('data-is-shared', 'false');
                                
                                    // 如果是在社区页面，移除该动态
                                    if (window.location.pathname === '/community/') {
                                        momentCard.classList.add('opacity-0');
                                        setTimeout(() => {
                                            momentCard.remove();
                                        }, 300);
                                    }
                                
                                    modal.classList.add('hidden');
                                } else {
                                    alert(data.error || '取消分享失败，请重试');
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('网络错误，请重试');
                            })
                            .finally(() => {
                                btn.disabled = false;
                                btn.innerHTML = '<i class="fa fa-undo mr-2"></i>取消分享';
                            });
                }
        );
    
        // 菜单按钮功能
        document.querySelectorAll('[id^="moreBtn-"]').forEach(button => {
            button.addEventListener('click', function () {
                const menuId = this.id.replace('moreBtn-', 'menu-');
                const menu = document.getElementById(menuId);
            
                // 关闭其他所有菜单
                document.querySelectorAll('[id^="menu-"]').forEach(otherMenu => {
                    if (otherMenu.id !== menuId) {
                        otherMenu.classList.add('hidden');
                    }
                });
            
                // 切换当前菜单
                menu.classList.toggle('hidden');
            });
        });
    
        // 点击其他区域关闭菜单
        document.addEventListener('click', (e) => {
            if (!e.target.closest('[id^="moreBtn-"]') && !e.target.closest('[id^="menu-"]')) {
                document.querySelectorAll('[id^="menu-"]').forEach(menu => {
                    menu.classList.add('hidden');
                });
            }
        });
    
        // 点赞功能
        document.querySelectorAll('.like-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                const icon = this.querySelector('i');
                const count = this.querySelector('span');
            
                if (icon.classList.contains('fa-regular')) {
                    icon.classList.remove('fa-regular');
                    icon.classList.add('fa-solid');
                    icon.style.color = '#FF6B8B';
                    count.textContent = parseInt(count.textContent) + 1;
                } else {
                    icon.classList.remove('fa-solid');
                    icon.classList.add('fa-regular');
                    icon.style.color = '';
                    count.textContent = parseInt(count.textContent) - 1;
                }
            });
        });
    
        // 评论功能（模拟打开评论框）
        document.querySelectorAll('.comment-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                alert('打开评论区（功能开发中）');
            });
        });
    
        // 用户下拉菜单
        const userAvatar = document.getElementById('userAvatar');
        const userOptions = document.getElementById('userOptions');
        const userDropdown = document.getElementById('userDropdown');
    
        let userCloseTimer;
    
        if (userAvatar && userOptions && userDropdown) {
            // 鼠标经过头像时打开菜单
            userAvatar.addEventListener('mouseenter', function () {
                clearTimeout(userCloseTimer);
                userOptions.classList.remove('hidden');
            });
        
            // 鼠标悬停在下拉菜单时保持菜单打开
            userDropdown.addEventListener('mouseenter', function () {
                clearTimeout(userCloseTimer);
                userOptions.classList.remove('hidden');
            });
        
            // 鼠标离开下拉菜单时关闭菜单
            userDropdown.addEventListener('mouseleave', function () {
                userCloseTimer = setTimeout(() => {
                    userOptions.classList.add('hidden');
                }, 500);
            });
        }
    
        // 更多选项下拉菜单
        const moreButton = document.getElementById('moreButton');
        const moreOptions = document.getElementById('moreOptions');
        const moreDropdown = document.getElementById('moreDropdown');
    
        let moreCloseTimer;
    
        if (moreButton && moreOptions && moreDropdown) {
            // 鼠标经过按钮时打开菜单
            moreButton.addEventListener('mouseenter', function () {
                clearTimeout(moreCloseTimer);
                moreOptions.classList.remove('hidden');
            });
        
            // 鼠标悬停在下拉菜单时保持菜单打开
            moreDropdown.addEventListener('mouseenter', function () {
                clearTimeout(moreCloseTimer);
                moreOptions.classList.remove('hidden');
            });
        
            // 鼠标离开下拉菜单时关闭菜单
            moreDropdown.addEventListener('mouseleave', function () {
                moreCloseTimer = setTimeout(() => {
                    moreOptions.classList.add('hidden');
                }, 500);
            });
        }
    });
</script >
</body >

</html >