<!DOCTYPE html>
<html lang = "zh-CN" >
<head >
    <meta charset = "UTF-8" >
    <meta name = "viewport" content = "width=device-width, initial-scale=1.0" >
    <title >我的相册 - LoveSync</title >
    <script src = "https://cdn.tailwindcss.com" ></script >
    <link href = "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel = "stylesheet" >
    <link href = "https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
          rel = "stylesheet" >
    <script >
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B8B', // 爱情粉色作为主色调
                        secondary: '#722ED1', // 紫色作为辅助色
                        neutral: {
                            100: '#F9F9F9',
                            200: '#F0F0F0',
                            300: '#E0E0E0',
                            400: '#BDBDBD',
                            500: '#9E9E9E',
                            600: '#757575',
                            700: '#616161',
                            800: '#424242',
                            900: '#212121',
                        }
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': {opacity: '0'},
                            '100%': {opacity: '1'},
                        },
                        slideUp: {
                            '0%': {transform: 'translateY(20px)', opacity: '0'},
                            '100%': {transform: 'translateY(0)', opacity: '1'},
                        }
                    }
                },
            }
        }
    </script >
    <style type = "text/tailwindcss" >
        @layer utilities {
            .transition-custom {
                transition: all 0.3s ease;
            }

            .hover-scale {
                transition: transform 0.3s ease;
            }

            .hover-scale:hover {
                transform: scale(1.02);
            }

            .bg-gradient-love {
                background: linear-gradient(135deg, #FF6B8B 0%, #722ED1 100%);
            }

            .self-badge {
                position: relative;
            }

            .self-badge::after {
                content: '我';
                position: absolute;
                bottom: -5px;
                right: -5px;
                background-color: #FF6B8B;
                color: white;
                border-radius: 50%;
                width: 16px;
                height: 16px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 10px;
                font-weight: bold;
            }

            .album-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 1.5rem;
            }

            .image-container {
                position: relative;
                overflow: hidden;
                border-radius: 0.75rem;
                aspect-ratio: 1/1;
            }

            .image-overlay {
                position: absolute;
                inset: 0;
                background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 60%);
                opacity: 0;
                transition: opacity 0.3s ease;
                display: flex;
                flex-direction: column;
                justify-content: flex-end;
                padding: 1rem;
                color: white;
            }

            .image-container:hover .image-overlay {
                opacity: 1;
            }
        }
    </style >
</head >

<body class = "font-inter bg-neutral-100 text-neutral-800 min-h-screen flex flex-col overflow-x-hidden relative scroll-smooth" >
    <!-- 背景装饰元素 -->
    <div class = "absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none" >
        <div class = "absolute -top-40 -left-40 w-80 h-80 bg-primary/10 rounded-full filter blur-3xl float-animation" ></div >
        <div class = "absolute -bottom-20 -right-20 w-80 h-80 bg-secondary/10 rounded-full filter blur-3xl float-animation"
             style = "animation-delay: -2s;" ></div >
        <div class = "absolute top-1/3 right-1/4 w-40 h-40 bg-primary/5 rounded-full filter blur-2xl float-animation"
             style = "animation-delay: -4s;" ></div >
    </div >

    <!-- 导航栏 -->
    <header class = "fixed w-full top-0 z-50 transition-all duration-300 bg-white/95 backdrop-blur-md shadow-sm py-3" >
        <div class = "container mx-auto px-4 flex items-center justify-between" >
            <!-- 品牌标识 -->
            <a href = "#" class = "flex items-center space-x-2" >
                <div class = "w-10 h-10 rounded-full bg-gradient-love flex items-center justify-center text-white shadow-md" >
                    <i class = "fa-solid fa-heart text-xl" ></i >
                </div >
                <span class = "text-xl font-bold text-neutral-800 tracking-tight" >LoveSync</span >
            </a >

            <!-- 桌面端导航菜单 -->
            <nav class = "hidden md:flex items-center space-x-6" >
                <a href = "{% url 'index' %}"
                   class = "text-neutral-700 hover:text-primary transition-custom font-medium px-1 py-2 border-b-2 border-transparent hover:border-primary" >双人日记</a >
                <a href = "{% url 'community' %}"
                   class = "text-neutral-700 hover:text-primary transition-custom font-medium px-1 py-2 border-b-2 border-transparent hover:border-primary" >社区</a >
                <a href = "{% url 'moments' %}"
                   class = "text-neutral-700 hover:text-primary transition-custom font-medium px-1 py-2 border-b-2 border-transparent hover:border-primary" >我们的动态</a >
                <a href = "{% url 'photo_album' %}"
                   class = "text-primary font-medium px-1 py-2 border-b-2 border-primary" >相册</a >
                <a href = "{% url 'favorites' %}"
                   class = "text-neutral-700 hover:text-primary transition-custom font-medium px-1 py-2 border-b-2 border-transparent hover:border-primary" >收藏</a >
            </nav >

            <!-- 内容过滤器 -->
            <div class = "bg-white/95 backdrop-blur-md rounded-xl shadow-lg p-2 flex justify-between items-center hover-scale" >
                <div class = "flex space-x-2" >
                    <a href = "{% url 'photo_album' %}"
                       class = "px-4 py-2 rounded-full bg-primary text-white text-sm font-medium" >
                        全部
                    </a >
                </div >
                <div class = "relative" >
                    <input type = "text" placeholder = "搜索相册..."
                           class = "pl-10 pr-4 py-2 rounded-full border border-neutral-200 focus:outline-none focus:ring-2 focus:ring-primary/50 form-input-focus text-sm" >
                    <i class = "fa-solid fa-search absolute left-4 top-1/2 -translate-y-1/2 text-neutral-400" ></i >
                </div >
            </div >

            <!-- 用户操作区 -->
            <div class = "flex items-center space-x-4" >
                <a href = "#upload-section"
                   class = "hidden md:flex items-center space-x-2 px-5 py-2 rounded-full bg-gradient-love text-white hover:opacity-90 transition-custom shadow-md hover:shadow-lg" >
                    <i class = "fa-solid fa-upload" ></i >
                    <span >上传照片</span >
                </a >

                <!-- 用户头像与下拉菜单 -->
                <div class = "relative" id = "userDropdown" >
                    <div class = "w-10 h-10 rounded-full overflow-hidden border-2 border-primary cursor-pointer shadow-sm"
                         id = "userAvatar" >
                        <img src = "{{ user.profile.userAvatar.url }}" alt = "用户头像"
                             class = "w-full h-full object-cover" >
                    </div >
                    <div class = "absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl py-2 z-50 hidden"
                         id = "userOptions" >
                        <a href = "{% url 'personal_center' %}"
                           class = "block px-4 py-2 text-neutral-700 hover:bg-neutral-50 transition-custom flex items-center" >
                            <i class = "fa-solid fa-user mr-2 w-5 text-center" ></i >主页
                        </a >
                        <a href = "{% url 'message' %}"
                           class = "block px-4 py-2 text-neutral-700 hover:bg-neutral-50 transition-custom flex items-center" >
                            <i class = "fa-solid fa-bookmark mr-2 w-5 text-center" ></i >消息
                        </a >
                        <a href = "{% url 'settings' %}"
                           class = "block px-4 py-2 text-neutral-700 hover:bg-neutral-50 transition-custom flex items-center" >
                            <i class = "fa-solid fa-cog mr-2 w-5 text-center" ></i >设置
                        </a >
                        <div class = "border-t border-neutral-200 my-1" ></div >
                        <a href = "{% url 'logout' %}"
                           class = "block px-4 py-2 text-red-500 hover:bg-red-50 transition-custom flex items-center" >
                            <i class = "fa-solid fa-sign-out mr-2 w-5 text-center" ></i >退出登录
                        </a >
                    </div >
                </div >

                <!-- 移动端菜单按钮 -->
                <button class = "md:hidden text-neutral-700 focus:outline-none" id = "menu-toggle" >
                    <i class = "fa-solid fa-bars text-xl" ></i >
                </button >
            </div >
        </div >

        <!-- 移动端菜单 -->
        <div id = "mobile-menu"
             class = "hidden md:hidden bg-white shadow-lg absolute w-full transform -translate-y-2 opacity-0 transition-all duration-200 ease-in-out"
             style = "top: 100%;" >
            <div class = "container mx-auto px-4 py-3 flex flex-col space-y-3" >
                <a href = "{% url 'index' %}"
                   class = "text-neutral-700 hover:text-primary py-2 transition-custom font-medium flex items-center" >
                    <i class = "fa-solid fa-book-open mr-3 w-5 text-center" ></i >双人日记
                </a >
                <a href = "{% url 'community' %}"
                   class = "text-neutral-700 hover:text-primary py-2 transition-custom font-medium flex items-center" >
                    <i class = "fa-solid fa-users mr-3 w-5 text-center" ></i >社区
                </a >
                <a href = "{% url 'moments' %}"
                   class = "text-neutral-700 hover:text-primary py-2 transition-custom font-medium flex items-center" >
                    <i class = "fa-solid fa-bolt mr-3 w-5 text-center" ></i >我们的动态
                </a >
                <a href = "{% url 'photo_album' %}" class = "text-primary py-2 font-medium flex items-center" >
                    <i class = "fa-solid fa-images mr-3 w-5 text-center" ></i >相册
                </a >
                <a href = "{% url 'favorites' %}"
                   class = "text-neutral-700 hover:text-primary py-2 transition-custom font-medium flex items-center" >
                    <i class = "fa-solid fa-bookmark mr-3 w-5 text-center" ></i >收藏
                </a >
                <div class = "border-t border-neutral-200 my-1" ></div >
                <a href = "{% url 'personal_center' %}"
                   class = "text-neutral-700 py-2 transition-custom flex items-center" >
                    <i class = "fa-solid fa-user mr-3 w-5 text-center" ></i >个人主页
                </a >
                <a href = "{% url 'message' %}" class = "text-neutral-700 py-2 transition-custom flex items-center" >
                    <i class = "fa-solid fa-bookmark mr-3 w-5 text-center" ></i >消息中心
                </a >
                <a href = "{% url 'settings' %}" class = "text-neutral-700 py-2 transition-custom flex items-center" >
                    <i class = "fa-solid fa-cog mr-3 w-5 text-center" ></i >设置中心
                </a >
                <div class = "border-t border-neutral-200 my-1" ></div >
                <a href = "{% url 'logout' %}" class = "text-red-500 py-2 transition-custom flex items-center" >
                    <i class = "fa-solid fa-sign-out mr-3 w-5 text-center" ></i >退出登录
                </a >
            </div >
        </div >
    </header >

    <!-- 主内容区 -->
    <main class = "flex-grow pt-24 pb-16 relative z-10" >
        <div class = "container mx-auto px-4" >
            <!-- 个人信息头部 -->
            <div class = "bg-white rounded-xl shadow-lg p-6 mb-8 animate-fade-in" >
                <div class = "flex flex-col md:flex-row items-center" >
                    <div class = "w-20 h-20 rounded-full overflow-hidden mb-4 md:mb-0 md:mr-6 border-4 border-primary/20 self-badge" >
                        <img src = "{{ user.profile.userAvatar.url }}" alt = "用户头像"
                             class = "w-full h-full object-cover" >
                    </div >
                    <div class = "text-center md:text-left" >
                        <h2 class = "text-2xl font-bold text-neutral-800 mb-1" >{{ user.name }}</h2 >
                        <p class = "text-neutral-600 mb-1" >记录我们的美好瞬间</p >
                        <p class = "text-neutral-700 mb-3 text-sm italic" >"每一张照片都是时光的标本"</p >
                        <div class = "flex flex-wrap justify-center md:justify-start gap-4" >
                            <div class = "text-center" >
                                <p class = "text-2xl font-bold text-primary" >{{ photo_count }}</p >
                                <p class = "text-neutral-500 text-sm" >照片</p >
                            </div >
                            <div class = "text-center" >
                                <p class = "text-2xl font-bold text-primary" >12</p >
                                <p class = "text-neutral-500 text-sm" >相册</p >
                            </div >
                            <div class = "text-center" >
                                <p class = "text-2xl font-bold text-primary" >{{ moment_count }}</p >
                                <p class = "text-neutral-500 text-sm" >动态</p >
                            </div >
                        </div >
                    </div >
                </div >
            </div >

            <!-- 上传照片区域 -->
            <div id = "upload-section" class = "bg-white rounded-xl shadow-md p-6 mb-8 animate-slide-up" >
                <h3 class = "text-xl font-semibold text-neutral-800 mb-4" >上传新照片</h3 >

                <form id = "uploadForm" method = "POST" enctype = "multipart/form-data" action = "{% url 'photo_album' %}" class = "space-y-4" >
                    {% csrf_token %}

                    <!-- 照片上传区域 -->
                    <div class = "border-2 border-dashed border-neutral-300 rounded-lg p-8 text-center hover:border-primary transition-custom cursor-pointer"
                         id = "drop-area" >
                        <input type = "file" id = "photoInput" name = "images" multiple accept = "image/*"
                               class = "hidden" >
                        <i class = "fa-solid fa-cloud-upload-alt text-4xl text-neutral-400 mb-3" ></i >
                        <p class = "text-neutral-600 mb-2" >点击或拖拽照片到这里上传</p >
                        <p class = "text-neutral-500 text-sm" >支持 JPG, PNG, GIF 格式</p >
                    </div >

                    <!-- 预览区域 -->
                    <div class = "grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 mb-4" id = "photo-preview" >
                        <!-- 预览图片将在这里动态生成 -->
                    </div >

                    <!-- 照片标签 -->
                    <div class = "mb-4" >
                        <label for = "tags" class = "block text-sm font-medium text-neutral-700 mb-1" >照片标签</label >
                        <input type = "text" id = "tags" name = "tags"
                               class = "w-full px-4 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-custom"
                               placeholder = "用逗号分隔多个标签，例如: 旅行, 美食, 纪念日" >
                        <p class = "text-neutral-500 text-xs mt-1" >最多添加5个标签，每个标签不超过10个字符</p >
                    </div >

                    <!-- 提交按钮 -->
                    <div class = "flex justify-end space-x-3" >
                        <button type = "button" id = "cancel-upload"
                                class = "px-4 py-2 border border-neutral-300 rounded-md text-neutral-700 hover:bg-neutral-50 transition-custom" >
                            取消
                        </button >
                        <button type = "submit"
                                class = "px-6 py-2 bg-gradient-love text-white rounded-lg hover:opacity-90 transition-custom shadow-md hover:shadow-lg flex items-center" >
                            <i class = "fa-solid fa-upload mr-2" ></i >
                            <span >上传照片</span >
                        </button >
                    </div >
                </form >
            </div >

            <!-- 相册网格 -->
            <div class = "album-grid animate-fade-in" >
                {% if photos %}
                    {% for photo in photos %}
                        <div class = "image-container hover-scale group" >
                            <img src = "{{ photo.image.url }}" alt = "{{ photo.description }}"
                                 class = "w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" >
                            <div class = "image-overlay" >
                                <div class = "flex justify-between items-end mb-2" >
                                    <div >
                                        <h4 class = "font-medium truncate max-w-[150px]" >{{ photo.description|default:"未命名照片" }}</h4 >
                                        <p class = "text-xs text-white/80" >{{ photo.uploaded_at|date:"Y-m-d" }}</p >
                                    </div >
                                    <div class = "flex space-x-2" >
                                        <button class = "text-white hover:text-primary transition-custom p-1 photo-detail-btn"
                                                data-photo-id = "{{ photo.id }}" >
                                            <i class = "fa-solid fa-eye" ></i >
                                        </button >
                                        <form method = "POST" action = "{% url 'delete_photo' photo.id %}" >
                                            {% csrf_token %}
                                            <input type = "hidden" name = "_method" value = "DELETE" >
                                            <button type = "submit"
                                                    class = "text-white hover:text-red-500 transition-custom p-1" >
                                                <i class = "fa-solid fa-trash-can" ></i >
                                            </button >
                                        </form >
                                    </div >
                                </div >
                            </div >
                        </div >
                    {% endfor %}
                {% else %}
                    <div class = "w-full text-center" >
                            <p class = "text-gray-500 italic" >你的相册还是空的，快去上传照片吧！</p >
                        </div >
                {% endif %}
            </div >

            <!-- 确认删除模板 -->
            {% if photo.id %}
                {% block content %}
                    <div class = "container mx-auto px-4 py-8" >
                    <div class = "bg-white rounded-xl shadow-lg p-6 max-w-md mx-auto" >
                        <h2 class = "text-xl font-bold text-neutral-800 mb-4" >确认删除</h2 >
                        <p class = "text-neutral-600 mb-6" >你确定要删除这张照片吗？此操作不可撤销。</p >

                        <div class = "flex justify-end space-x-3" >
                            <a href = "{% url 'photo_album' %}"
                               class = "px-4 py-2 border border-neutral-300 rounded-md text-neutral-700 hover:bg-neutral-50 transition-custom" >
                                取消
                            </a >
                            <form method = "POST" action = "{% url 'delete_photo' photo.id %}" >
                                {% csrf_token %}
                                <button type = "submit"
                                        class = "px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-custom" >
                                    <i class = "fa fa-trash mr-2" ></i >删除
                                </button >
                            </form >
                        </div >
                    </div >
                </div >
                {% endblock %}
            {% endif %}

        </div >
    </main >

    <!-- 页脚 -->
    <footer class = "bg-white border-t border-neutral-200 py-8" >
        <div class = "container mx-auto px-4" >
            <div class = "flex flex-col md:flex-row justify-between items-center" >
                <div class = "flex items-center space-x-2" >
                    <div class = "w-8 h-8 bg-gradient-love rounded-full text-white" >
                        <i class = "fa-solid fa-heart" ></i >
                    </div >
                    <span class = "text-lg font-bold" >LoveSync</span >
                </div >
                <div class = "text-neutral-500 text-sm" >
                    &copy; 2023 LoveSync. 我们的故事，正在相册里持续更新。
                </div >
            </div >
        </div >
    </footer >

    <!-- 交互逻辑 -->
    <script >
        document.addEventListener('DOMContentLoaded', () => {
            // 移动端菜单切换
            const menuToggle = document.getElementById('menu-toggle');
            const mobileMenu = document.getElementById('mobile-menu');

            menuToggle.addEventListener('click', function () {
                if (mobileMenu.classList.contains('hidden')) {
                    mobileMenu.classList.remove('hidden');
                    setTimeout(() => {
                        mobileMenu.classList.add('translate-y-0', 'opacity-100');
                    }, 50);
                } else {
                    mobileMenu.classList.remove('translate-y-0', 'opacity-100');
                    setTimeout(() => {
                        mobileMenu.classList.add('hidden');
                    }, 200);
                }
            });

            // 拖放上传功能
            const dropArea = document.getElementById('drop-area');
            const photoInput = document.getElementById('photoInput');
            const photoPreview = document.getElementById('photo-preview');

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea?.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea?.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropArea?.addEventListener(eventName, unhighlight, false);
            });

            function highlight() {
                dropArea?.classList.add('border-primary');
                dropArea?.classList.add('bg-primary/5');
            }

            function unhighlight() {
                dropArea?.classList.remove('border-primary');
                dropArea?.classList.remove('bg-primary/5');
            }

            dropArea?.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }

            // 点击上传区域
            dropArea?.addEventListener('click', () => {
                photoInput?.click();
            });

            // 选择文件后预览
            photoInput?.addEventListener('change', () => {
                const files = photoInput.files;
                handleFiles(files);
            });

            // 处理文件预览
            function handleFiles(files) {
                photoPreview.innerHTML = '';

                for (const file of files) {
                    if (!file.type.startsWith('image/')) {
                        alert('请选择图片文件');
                        continue;
                    }

                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.className = 'w-full h-24 object-cover rounded-md';

                    const previewItem = document.createElement('div');
                    previewItem.className = 'relative';
                    previewItem.appendChild(img);

                    photoPreview.appendChild(previewItem);
                }
            }

            // 取消上传
            const cancelUpload = document.getElementById('cancel-upload');
            cancelUpload?.addEventListener('click', function () {
                photoPreview.innerHTML = '';
                photoInput.value = '';
            });

            // 用户下拉菜单
            const userAvatar = document.getElementById('userAvatar');
            const userOptions = document.getElementById('userOptions');
            const userDropdown = document.getElementById('userDropdown');

            let userCloseTimer;

            if (userAvatar && userOptions && userDropdown) {
                // 鼠标经过头像时打开菜单
                userAvatar.addEventListener('mouseenter', function () {
                    clearTimeout(userCloseTimer);
                    userOptions.classList.remove('hidden');
                });

                // 鼠标悬停在下拉菜单时保持菜单打开
                userDropdown.addEventListener('mouseenter', function () {
                    clearTimeout(userCloseTimer);
                    userOptions.classList.remove('hidden');
                });

                // 鼠标离开下拉菜单时关闭菜单
                userDropdown.addEventListener('mouseleave', function () {
                    userCloseTimer = setTimeout(() => {
                        userOptions.classList.add('hidden');
                    }, 500);
                });
            }

            // 滚动时导航栏效果
            const header = document.querySelector('header');
            let lastScrollTop = 0;

            window.addEventListener('scroll', function () {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

                if (scrollTop > 100) {
                    header.classList.add('shadow-md');
                    header.classList.remove('py-3');
                    header.classList.add('py-2');
                } else {
                    header.classList.remove('shadow-md');
                    header.classList.remove('py-2');
                    header.classList.add('py-3');
                }

                lastScrollTop = scrollTop;
            });

            // 图片详情查看功能
            document.querySelectorAll('.photo-detail-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const photoId = this.getAttribute('data-photo-id');
                    // 这里可以添加查看详情的逻辑
                    alert(`查看照片详情: ${photoId}`);
                });
            });

            // 移动端上传按钮
            const mobileUploadButton = document.createElement('button');
            mobileUploadButton.className = 'fixed bottom-6 right-6 w-14 h-14 bg-gradient-love rounded-full shadow-lg flex items-center justify-center text-white z-40 md:hidden';
            mobileUploadButton.innerHTML = '<i class="fa-solid fa-plus text-xl"></i>';
            mobileUploadButton.addEventListener('click', function () {
                document.getElementById('upload-section').scrollIntoView({behavior: 'smooth'});
            });
            document.body.appendChild(mobileUploadButton);

            // 平滑滚动
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();

                    const targetId = this.getAttribute('href');
                    if (targetId === '#') return;

                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                });
            });
        });
    </script >
</body >
</html >