{% extends 'vip/vip_base.html' %}

{% block vip_content %}

<div class="bg-white p-6 rounded-xl shadow-sm border border-neutral-200">
    <h3 class="text-lg font-semibold text-neutral-800 mb-4">充值历史</h3>

    {% if page_obj.object_list %}
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-neutral-200">
            <thead class="bg-neutral-50">
                <tr>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">订单号
                    </th>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">充值金额
                    </th>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">时长
                    </th>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">状态
                    </th>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">创建时间
                    </th>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">支付时间
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-neutral-200">
                {% for record in page_obj.object_list %}
                <tr class="hover:bg-neutral-50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900 font-medium">
                        {% with order_num=record.order_number %}{{ order_num }}{% endwith %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-600">¥{{ record.amount }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-600">{{ record.duration }}天</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span
                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                                  {% if record.status == 'success' %}bg-green-100 text-green-800{% elif record.status == 'pending' %}bg-yellow-100 text-yellow-800{% elif record.status == 'failed' %}bg-red-100 text-red-800{% elif record.status == 'cancelled' %}bg-neutral-100 text-neutral-800{% endif %}">
                            {{ record.get_status_display }}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-600">
                        {{ record.created_at|date:'Y-m-d H:i' }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-600">
                        {% if record.paid_at %}
                        {{ record.paid_at|date:'Y-m-d H:i' }}
                        {% else %}
                        - - - - - -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- 分页导航 -->
    <div class="mt-6 flex items-center justify-between border-t border-neutral-200 pt-4">
        <div class="text-sm text-neutral-600">
            共 {{ page_obj.paginator.count }} 条记录，当前第 {{ page_obj.number }} 页，共 {{ page_obj.paginator.num_pages }} 页
        </div>
        <div class="flex space-x-1">
            {% if page_obj.has_previous %}
            <a href="?page=1"
                class="px-3 py-1 border border-neutral-300 rounded-md text-sm text-neutral-700 hover:bg-neutral-50 transition-colors">首页</a>
            <a href="?page={{ page_obj.previous_page_number }}"
                class="px-3 py-1 border border-neutral-300 rounded-md text-sm text-neutral-700 hover:bg-neutral-50 transition-colors">上一页</a>
            {% else %}
            <span
                class="px-3 py-1 border border-neutral-300 rounded-md text-sm text-neutral-400 cursor-not-allowed">首页</span>
            <span
                class="px-3 py-1 border border-neutral-300 rounded-md text-sm text-neutral-400 cursor-not-allowed">上一页</span>
            {% endif %}

            <!-- 显示当前页周围的页码 -->
            {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
            <span class="px-3 py-1 border border-primary bg-primary text-white rounded-md text-sm">
                {{ num }}
            </span>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %} <a href="?page={{ num }}"
                class="px-3 py-1 border border-neutral-300 rounded-md text-sm text-neutral-700 hover:bg-neutral-50 transition-colors">
                {{ num }}
                </a>
                {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}"
                    class="px-3 py-1 border border-neutral-300 rounded-md text-sm text-neutral-700 hover:bg-neutral-50 transition-colors">下一页</a>
                <a href="?page={{ page_obj.paginator.num_pages }}"
                    class="px-3 py-1 border border-neutral-300 rounded-md text-sm text-neutral-700 hover:bg-neutral-50 transition-colors">末页</a>
                {% else %}
                <span
                    class="px-3 py-1 border border-neutral-300 rounded-md text-sm text-neutral-400 cursor-not-allowed">下一页</span>
                <span
                    class="px-3 py-1 border border-neutral-300 rounded-md text-sm text-neutral-400 cursor-not-allowed">末页</span>
                {% endif %}
        </div>
    </div>
    {% else %}
    <!-- 没有充值记录时的提示 -->
    <div class="text-center py-12">
        <i class="fa-solid fa-file-invoice text-5xl text-neutral-300 mb-4"></i>
        <div class="text-lg text-neutral-600 mb-2">暂无充值记录</div>
        <a href="{% url 'vip:create_recharge' %}"
            class="inline-flex items-center px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
            <i class="fa-solid fa-plus mr-2"></i>立即充值
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}