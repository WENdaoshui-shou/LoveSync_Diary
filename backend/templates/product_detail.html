{% extends 'base.html' %}
{% block title %}{{ product.name }} - LoveSync情侣商城{% endblock %}

{% block extra_css %}
<style type="text/tailwindcss">
    @layer utilities {
        .float-animation {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-20px);
            }
            100% {
                transform: translateY(0px);
            }
        }

        .product-card {
            transition: all 0.3s ease;
        }

        .product-card:hover {
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            transform: translateY(-5px);
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .text-shadow {
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .text-gradient {
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            background-image: linear-gradient(135deg, #FF6B8B 0%, #722ED1 100%);
        }

        .card-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 10px 10px -5px rgba(0, 0, 0, 0.01);
        }

        .message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            border-radius: 4px;
            color: white;
            z-index: 1000;
            display: none;
        }

        .message.success {
            background-color: #4CAF50;
            display: block;
        }

        .message.error {
            background-color: #f44336;
            display: block;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="font-inter bg-neutral-100 text-neutral-800 min-h-screen flex flex-col overflow-x-hidden relative">

    <!-- 背景装饰元素 -->
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
        <div class="absolute -top-40 -left-40 w-80 h-80 bg-primary/10 rounded-full filter blur-3xl float-animation">
        </div>
        <div class="absolute -bottom-20 -right-20 w-80 h-80 bg-secondary/10 rounded-full filter blur-3xl float-animation"
            style="animation-delay: -2s;"></div>
        <div class="absolute top-1/3 right-1/4 w-40 h-40 bg-primary/5 rounded-full filter blur-2xl float-animation"
            style="animation-delay: -4s;"></div>
    </div>

    <!-- 主内容区 -->
    <div class="flex-grow pt-32 pb-16 relative z-10">
        <div class="container mx-auto px-4">
            <!-- 面包屑导航 -->
            <div class="flex items-center text-sm text-neutral-500 mb-6">
                <a href="#" class="hover:text-primary">首页</a>
                <i class="fa-solid fa-chevron-right text-xs mx-2"></i>
                <a href="#" class="hover:text-primary">{{ product.category }}</a>
                <i class="fa-solid fa-chevron-right text-xs mx-2"></i>
                <span class="text-neutral-700">{{ product.name }}</span>
            </div>

            <!-- 商品详情区 -->
            <div class="bg-white rounded-xl shadow-sm overflow-hidden mb-8">
                <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                    <!-- 商品图片区 -->
                    <div class="lg:col-span-2 p-6">
                        <div class="bg-neutral-100 rounded-lg overflow-hidden mb-4">
                            <img src="{{ product.image }}" alt="{{ product.name }}"
                                class="w-full h-auto object-cover hover-scale">
                        </div>

                        <!-- 缩略图预览 -->
                        <div class="grid grid-cols-4 gap-2">
                            {% for image in product.images.all|slice:":4" %}
                            <div
                                class="border-2 border-neutral-200 rounded-md cursor-pointer hover:border-primary transition-custom hover-scale">
                                <img src="{{ image.url }}" alt="{{ product.name }}" class="w-full h-16 object-cover">
                            </div>
                            {% endfor %}
                            <!-- 更多图片提示 -->
                            {% if product.images.count > 4 %}
                            <div
                                class="border-2 border-dashed border-neutral-300 rounded-md cursor-pointer hover:border-primary flex items-center justify-center text-neutral-500 hover-scale">
                                <span class="text-xs">+{{ product.images.count|add:"-4" }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- 商品信息区 -->
                    <div class="lg:col-span-3 p-6">
                        <div class="mb-4">
                            <span class="inline-block bg-primary/10 text-primary text-xs px-3 py-1 rounded-full mb-3">
                                {{ product.category }}
                            </span>
                            <h1 class="text-2xl md:text-3xl font-bold text-neutral-800 mb-3">{{ product.name }}</h1>
                            <div class="flex items-center mb-4">
                                <div class="flex items-center text-yellow-400 mr-2">
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star-half-stroke"></i>
                                    <span class="ml-1 text-neutral-600">{{ product.rating }}</span>
                                </div>
                                <span class="text-neutral-500 text-sm">({{ product.num_reviews }} 条评价)</span>
                            </div>
                        </div>

                        <!-- 价格区 -->
                        <div class="bg-neutral-50 p-4 rounded-lg mb-6">
                            <div class="flex items-end mb-2">
                                <span class="text-primary text-3xl font-bold">¥{{ product.price }}</span>
                                <span class="text-neutral-400 line-through ml-2 text-sm">¥{{ product.original_price
                                    }}</span>
                                <span class="ml-2 bg-primary/10 text-primary text-xs px-2 py-0.5 rounded">
                                    节省 ¥{{ product.original_price|add:'999' }}
                                </span>
                            </div>
                            <div class="flex items-center text-sm text-neutral-600">
                                <span>月销量: {{ product.monthly_sales }}</span>
                                <span class="mx-4">库存: {{ product.product_stock }} 件</span>
                            </div>
                        </div>

                        <!-- 促销信息 -->
                        <div class="mb-6">
                            <div class="flex items-start mb-3">
                                <span class="text-neutral-500 text-sm min-w-[80px] pt-1">促销:</span>
                                <div>
                                    <div class="inline-flex items-center text-sm text-primary mb-2">
                                        <span class="bg-primary/10 px-2 py-0.5 rounded text-xs mr-2">限时优惠</span>
                                        <span>满100减20，满200减50</span>
                                    </div>
                                    <div class="inline-flex items-center text-sm text-primary ml-0 md:ml-4 mb-2">
                                        <span class="bg-primary/10 px-2 py-0.5 rounded text-xs mr-2">赠品</span>
                                        <span>下单赠送精美配件</span>
                                    </div>
                                    <div class="inline-flex items-center text-sm text-primary ml-0 md:ml-4">
                                        <span class="bg-primary/10 px-2 py-0.5 rounded text-xs mr-2">包邮</span>
                                        <span>全场满99元包邮</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 数量选择 -->
                        <div class="flex items-center mb-6">
                            <span class="text-neutral-500 text-sm min-w-[80px]">数量:</span>
                            <div class="flex border rounded-lg">
                                <button
                                    class="w-10 h-10 flex items-center justify-center text-neutral-500 hover:text-primary border-r"
                                    id="decrease-btn" onclick="changeQuantity(-1)">
                                    <i class="fa-solid fa-minus"></i>
                                </button>
                                <input type="number" value="1" min="1" max="{{ product.stock }}"
                                    class="w-16 h-10 text-center border-none focus:outline-none" id="quantity">
                                <button
                                    class="w-10 h-10 flex items-center justify-center text-neutral-500 hover:text-primary border-l"
                                    id="increase-btn" onclick="changeQuantity(1)">
                                    <i class="fa-solid fa-plus"></i>
                                </button>
                            </div>
                            <span class="ml-3 text-neutral-500 text-sm">库存: {{ product.stock }} 件</span>
                        </div>

                        <!-- 操作按钮 -->
                        <div class="flex flex-col sm:flex-row space-x-4 space-y-4 sm:space-y-0">
                            <button
                                class="add-to-cart-btn flex-1 bg-primary text-white py-3 rounded-lg font-medium hover:bg-primary/90 transition-custom flex items-center justify-center btn-pulse"
                                onclick="if(typeof window.addToCart === 'function'){ window.addToCart('{{ product.id|escapejs }}'); } else { alert('添加购物车功能未加载'); console.error('addToCart不是函数'); }">
                                <i class="fa-solid fa-shopping-cart mr-2"></i>
                                加入购物车
                            </button>
                            <button
                                class="flex-1 bg-secondary text-white py-3 rounded-lg font-medium hover:bg-secondary/90 transition-custom flex items-center justify-center"
                                onclick="window.location.href='{% url 'checkout' product.id %}'">
                                <i class="fa-solid fa-bolt mr-2"></i>
                                立即购买
                            </button>
                            <button
                                class="w-full sm:w-12 h-12 border border-neutral-200 rounded-lg flex items-center justify-center text-neutral-500 hover:text-primary hover:border-primary transition-custom">
                                <i class="fa-solid fa-heart"></i>
                            </button>
                        </div>

                        <!-- 服务保障 -->
                        <div class="flex flex-wrap items-center mt-6 text-sm text-neutral-600">
                            <div class="flex items-center mr-6 mb-2">
                                <i class="fa-solid fa-check-circle text-primary mr-1"></i>
                                <span>正品保障</span>
                            </div>
                            <div class="flex items-center mr-6 mb-2">
                                <i class="fa-solid fa-truck text-primary mr-1"></i>
                                <span>7天无理由退换</span>
                            </div>
                            <div class="flex items-center mr-6 mb-2">
                                <i class="fa-solid fa-headphones text-primary mr-1"></i>
                                <span>24小时客服</span>
                            </div>
                            <div class="flex items-center mb-2">
                                <i class="fa-solid fa-shield text-primary mr-1"></i>
                                <span>支付安全</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 商品详情和评论选项卡 -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- 左侧商品详情和评论 -->
                <div class="lg:col-span-2 space-y-8">
                    <!-- 选项卡导航 -->
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="flex border-b">
                            <button
                                class="tab-button active py-4 px-6 font-medium text-primary border-b-2 border-primary"
                                data-tab="description">
                                商品详情
                            </button>
                            <button class="tab-button py-4 px-6 font-medium text-neutral-500 hover:text-neutral-700"
                                data-tab="reviews">
                                商品评价 ({{ product.num_reviews }})
                            </button>
                        </div>

                        <!-- 商品描述选项卡 -->
                        <div class="tab-content p-6" id="description">
                            <div class="space-y-6">
                                <h2 class="text-xl font-bold text-neutral-800">商品介绍</h2>
                                <div class="prose max-w-none">
                                    {{ product.description|safe }}
                                </div>

                                <h2 class="text-xl font-bold text-neutral-800">产品规格</h2>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="p-4 bg-neutral-50 rounded-lg">
                                        <h3 class="font-medium mb-2">材质</h3>
                                        <p>{{ product.material }}</p>
                                    </div>
                                    <div class="p-4 bg-neutral-50 rounded-lg">
                                        <h3 class="font-medium mb-2">颜色</h3>
                                        <p>{{ product.color }}</p>
                                    </div>
                                    <div class="p-4 bg-neutral-50 rounded-lg">
                                        <h3 class="font-medium mb-2">尺寸</h3>
                                        <p>{{ product.size }}</p>
                                    </div>
                                    <div class="p-4 bg-neutral-50 rounded-lg">
                                        <h3 class="font-medium mb-2">重量</h3>
                                        <p>{{ product.weight }}</p>
                                    </div>
                                    <div class="p-4 bg-neutral-50 rounded-lg">
                                        <h3 class="font-medium mb-2">包装</h3>
                                        <p>{{ product.packing }}</p>
                                    </div>
                                    <div class="p-4 bg-neutral-50 rounded-lg">
                                        <h3 class="font-medium mb-2">产地</h3>
                                        <p>{{ product.origin }}</p>
                                    </div>
                                </div>

                                <h2 class="text-xl font-bold text-neutral-800">使用说明</h2>
                                <div class="bg-neutral-50 p-4 rounded-lg">
                                    <ul class="list-disc pl-5 space-y-2">
                                        <li>{{ product.instructions|safe }}</li>
                                    </ul>
                                </div>

                                <h2 class="text-xl font-bold text-neutral-800">注意事项</h2>
                                <div class="bg-neutral-50 p-4 rounded-lg">
                                    <ul class="list-disc pl-5 space-y-2">
                                        <li>{{ product.precautions|safe }}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- 商品评论选项卡 -->
                        <div class="tab-content p-6 hidden" id="reviews">
                            <div class="space-y-6">
                                <h2 class="text-xl font-bold text-neutral-800">用户评价 ({{ product.num_reviews }})</h2>

                                <!-- 评分概览 -->
                                <div class="bg-neutral-50 p-6 rounded-lg flex flex-col md:flex-row">
                                    <div class="md:w-1/3 text-center md:text-left mb-6 md:mb-0">
                                        <div class="text-5xl font-bold text-primary mb-2">{{ product.rating }}</div>
                                        <div class="flex items-center justify-center md:justify-start mb-2">
                                            <i class="fa-solid fa-star text-yellow-400"></i>
                                            <i class="fa-solid fa-star text-yellow-400"></i>
                                            <i class="fa-solid fa-star text-yellow-400"></i>
                                            <i class="fa-solid fa-star text-yellow-400"></i>
                                            <i class="fa-solid fa-star-half-stroke text-yellow-400"></i>
                                        </div>
                                        <div class="text-neutral-600">基于 {{ product.num_reviews }} 条评价</div>
                                    </div>
                                    <div class="md:w-2/3">
                                        <div class="space-y-3">
                                            <div class="flex items-center">
                                                <span class="text-sm w-16">5 星</span>
                                                <div class="flex-1 mx-2 bg-neutral-200 rounded-full h-2">
                                                    <div class="bg-yellow-400 h-2 rounded-full"
                                                        style="width: {{ five_star_percentage }}%"></div>
                                                </div>
                                                <span class="text-sm w-12 text-right">{{ five_star_count }}</span>
                                            </div>
                                            <div class="flex items-center">
                                                <span class="text-sm w-16">4 星</span>
                                                <div class="flex-1 mx-2 bg-neutral-200 rounded-full h-2">
                                                    <div class="bg-yellow-400 h-2 rounded-full"
                                                        style="width: {{ four_star_percentage }}%"></div>
                                                </div>
                                                <span class="text-sm w-12 text-right">{{ four_star_count }}</span>
                                            </div>
                                            <div class="flex items-center">
                                                <span class="text-sm w-16">3 星</span>
                                                <div class="flex-1 mx-2 bg-neutral-200 rounded-full h-2">
                                                    <div class="bg-yellow-400 h-2 rounded-full"
                                                        style="width: {{ three_star_percentage }}%"></div>
                                                </div>
                                                <span class="text-sm w-12 text-right">{{ three_star_count }}</span>
                                            </div>
                                            <div class="flex items-center">
                                                <span class="text-sm w-16">2 星</span>
                                                <div class="flex-1 mx-2 bg-neutral-200 rounded-full h-2">
                                                    <div class="bg-yellow-400 h-2 rounded-full"
                                                        style="width: {{ two_star_percentage }}%"></div>
                                                </div>
                                                <span class="text-sm w-12 text-right">{{ two_star_count }}</span>
                                            </div>
                                            <div class="flex items-center">
                                                <span class="text-sm w-16">1 星</span>
                                                <div class="flex-1 mx-2 bg-neutral-200 rounded-full h-2">
                                                    <div class="bg-yellow-400 h-2 rounded-full"
                                                        style="width: {{ one_star_percentage }}%"></div>
                                                </div>
                                                <span class="text-sm w-12 text-right">{{ one_star_count }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 评论列表 -->
                                <div class="space-y-6">
                                    {% for review in reviews %}
                                    <div class="border-b border-neutral-100 pb-6">
                                        <div class="flex items-start justify-between mb-3">
                                            <div class="flex items-center">
                                                <img src="{{ review.user.profile.userAvatar.url }}"
                                                    alt="{{ review.user.username }}"
                                                    class="w-10 h-10 rounded-full object-cover mr-3">
                                                <div>
                                                    <h4 class="font-medium">{{ review.user.username }}</h4>
                                                    <div class="flex items-center text-sm text-neutral-500">
                                                        <span>{{ review.created_at|date:"Y-m-d" }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="flex text-yellow-400">
                                                {% for i in '12345' %}
                                                {% if forloop.counter <= review.rating %} <i class="fa-solid fa-star">
                                                    </i>
                                                    {% else %}
                                                    <i class="fa-regular fa-star"></i>
                                                    {% endif %}
                                                    {% endfor %}
                                            </div>
                                        </div>
                                        <p class="mb-3">{{ review.content }}</p>
                                        {% if review.images.all %}
                                        <div class="grid grid-cols-3 gap-2 mb-3">
                                            {% for image in review.images.all %}
                                            <img src="{{ image.url }}" alt="用户评论图片"
                                                class="w-full h-20 object-cover rounded-lg">
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                        <div class="flex items-center text-sm text-neutral-500">
                                            <button class="flex items-center hover:text-primary">
                                                <i class="fa-regular fa-thumbs-up mr-1"></i>
                                                <span>{{ review.likes }}</span>
                                            </button>
                                            <span class="mx-3">|</span>
                                            <button class="hover:text-primary">回复</button>
                                        </div>
                                    </div>
                                    {% endfor %}

                                    <!-- 加载更多评论 -->
                                    <button
                                        class="w-full py-3 border border-neutral-200 rounded-lg text-neutral-700 hover:bg-neutral-50 transition-custom">
                                        加载更多评论
                                    </button>
                                </div>

                                <!-- 发表评论 -->
                                <div class="bg-neutral-50 p-6 rounded-lg">
                                    <h3 class="text-lg font-bold mb-4">发表评论</h3>
                                    <form>
                                        <div class="mb-4">
                                            <label class="block text-neutral-700 mb-2">评分</label>
                                            <div class="flex text-neutral-300 text-xl cursor-pointer" id="rating-stars">
                                                <i class="fa-regular fa-star mr-1" data-rating="1"></i>
                                                <i class="fa-regular fa-star mr-1" data-rating="2"></i>
                                                <i class="fa-regular fa-star mr-1" data-rating="3"></i>
                                                <i class="fa-regular fa-star mr-1" data-rating="4"></i>
                                                <i class="fa-regular fa-star" data-rating="5"></i>
                                            </div>
                                        </div>
                                        <div class="mb-4">
                                            <label class="block text-neutral-700 mb-2">评论内容</label>
                                            <textarea rows="4"
                                                class="w-full p-3 border border-neutral-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 form-input-focus"
                                                placeholder="分享你的使用体验..."></textarea>
                                        </div>
                                        <div class="mb-6">
                                            <label class="block text-neutral-700 mb-2">上传图片</label>
                                            <div class="flex flex-wrap gap-3">
                                                <div
                                                    class="w-20 h-20 border-2 border-dashed border-neutral-300 rounded-lg flex items-center justify-center cursor-pointer hover:border-primary transition-custom">
                                                    <i class="fa-regular fa-image text-2xl text-neutral-400"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <button type="submit"
                                            class="bg-primary text-white py-3 px-6 rounded-lg font-medium hover:bg-primary/90 transition-custom">
                                            提交评论
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 相关推荐 -->
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="p-6">
                            <h2 class="text-xl font-bold text-neutral-800 mb-4">相关推荐</h2>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                {% for related_product in related_products %}
                                <div class="product-card bg-white rounded-lg overflow-hidden border border-neutral-100">
                                    <div class="relative">
                                        <img src="{{ related_product.image }}" alt="{{ related_product.name }}"
                                            class="w-full h-48 object-cover">
                                        {% if related_product.discount > 0 %}
                                        <div
                                            class="absolute top-2 left-2 bg-primary text-white text-xs px-2 py-1 rounded">
                                            {{ related_product.discount }}折
                                        </div>
                                        {% endif %}
                                    </div>
                                    <div class="p-3">
                                        <h3 class="font-medium text-neutral-800 truncate">{{ related_product.name }}
                                        </h3>
                                        <div class="flex items-center mt-1 text-sm">
                                            <div class="flex text-yellow-400 text-xs mr-1">
                                                <i class="fa-solid fa-star"></i>
                                                <i class="fa-solid fa-star"></i>
                                                <i class="fa-solid fa-star"></i>
                                                <i class="fa-solid fa-star"></i>
                                                <i class="fa-solid fa-star-half-stroke"></i>
                                            </div>
                                            <span class="text-neutral-500">{{ related_product.rating }}</span>
                                        </div>
                                        <div class="flex items-center justify-between mt-2">
                                            <span class="text-primary font-bold">¥{{ related_product.price }}</span>
                                            <button
                                                class="w-8 h-8 flex items-center justify-center rounded-full bg-primary/10 text-primary hover:bg-primary hover:text-white transition-custom">
                                                <i class="fa-solid fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右侧商家信息和推荐 -->
                <div class="space-y-8">
                    <!-- 商家信息 -->
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="p-6">
                            <div class="flex items-center mb-4">
                                <img src="{{ product.shop.logo }}" alt="{{ product.shop.name }}"
                                    class="w-12 h-12 rounded-full object-cover mr-3">
                                <div>
                                    <h3 class="font-bold text-neutral-800">{{ product.shop.name }}</h3>
                                    <div class="flex items-center text-sm">
                                        <span class="text-primary flex items-center mr-3">
                                            <i class="fa-solid fa-shield-check mr-1"></i>
                                            商家认证
                                        </span>
                                        <span class="text-neutral-500">
                                            <i class="fa-solid fa-clock mr-1"></i>
                                            已入驻 {{ product.shop.years_settled }} 年
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="grid grid-cols-3 gap-2 mb-4">
                                <div class="text-center">
                                    <div class="text-lg font-bold text-primary">{{ product.shop.rating }}</div>
                                    <div class="text-xs text-neutral-500">店铺评分</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-lg font-bold text-primary">{{ product.shop.product_count }}</div>
                                    <div class="text-xs text-neutral-500">商品数量</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-lg font-bold text-primary">{{ product.shop.follower_count }}</div>
                                    <div class="text-xs text-neutral-500">粉丝数量</div>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button
                                    class="flex-1 py-2 border border-primary text-primary rounded-lg hover:bg-primary hover:text-white transition-custom">
                                    <i class="fa-solid fa-comment-dots mr-1"></i>
                                    联系商家
                                </button>
                                <button
                                    class="flex-1 py-2 border border-neutral-200 text-neutral-700 rounded-lg hover:bg-neutral-50 transition-custom">
                                    <i class="fa-solid fa-store mr-1"></i>
                                    进入店铺
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 猜你喜欢 -->
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="p-6">
                            <h2 class="text-xl font-bold text-neutral-800 mb-4">猜你喜欢</h2>
                            <div class="space-y-4">
                                {% for recommended_product in recommended_products %}
                                <div class="flex items-center">
                                    <img src="{{ recommended_product.image }}" alt="{{ recommended_product.name }}"
                                        class="w-16 h-16 rounded-lg object-cover mr-3">
                                    <div class="flex-1">
                                        <h3 class="font-medium text-neutral-800 truncate">{{ recommended_product.name }}
                                        </h3>
                                        <div class="flex items-center mt-1">
                                            <span class="text-primary font-bold">¥{{ recommended_product.price }}</span>
                                            <div class="flex text-yellow-400 text-xs ml-2">
                                                {% for i in '12345' %}
                                                {% if forloop.counter <= recommended_product.rating %} <i
                                                    class="fa-solid fa-star"></i>
                                                    {% else %}
                                                    <i class="fa-regular fa-star"></i>
                                                    {% endif %}
                                                    {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <!-- 优惠活动 -->
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="p-6">
                            <h2 class="text-xl font-bold text-neutral-800 mb-4">优惠活动</h2>
                            <div class="space-y-3">
                                <div class="flex items-center p-3 bg-primary/5 rounded-lg">
                                    <i class="fa-solid fa-tag text-primary mr-3"></i>
                                    <div>
                                        <h3 class="font-medium">新用户专享</h3>
                                        <p class="text-sm text-neutral-600">注册即送100元新人券</p>
                                    </div>
                                </div>
                                <div class="flex items-center p-3 bg-primary/5 rounded-lg">
                                    <i class="fa-solid fa-gift text-primary mr-3"></i>
                                    <div>
                                        <h3 class="font-medium">满减活动</h3>
                                        <p class="text-sm text-neutral-600">全场满100减20，满200减50</p>
                                    </div>
                                </div>
                                <div class="flex items-center p-3 bg-primary/5 rounded-lg">
                                    <i class="fa-solid fa-truck text-primary mr-3"></i>
                                    <div>
                                        <h3 class="font-medium">免邮优惠</h3>
                                        <p class="text-sm text-neutral-600">全场满99元免运费</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // 商品详情选项卡切换
    document.addEventListener('DOMContentLoaded', function () {
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetTab = button.getAttribute('data-tab');

                // 移除所有活动状态
                tabButtons.forEach(btn => btn.classList.remove('active', 'text-primary', 'border-primary'));
                tabButtons.forEach(btn => btn.classList.add('text-neutral-500'));
                tabContents.forEach(content => content.classList.add('hidden'));

                // 添加当前活动状态
                button.classList.add('active', 'text-primary', 'border-primary');
                button.classList.remove('text-neutral-500');
                document.getElementById(targetTab).classList.remove('hidden');
            });
        });

        // 数量增减
        function changeQuantity(change) {
            const input = document.getElementById('quantity');
            let currentValue = parseInt(input.value);
            const newValue = currentValue + change;

            if (newValue >= 1 && newValue <= parseInt(input.max)) {
                input.value = newValue;
            }
        }

        // 评分星星点击效果
        const ratingStars = document.getElementById('rating-stars');
        if (ratingStars) {
            const stars = ratingStars.querySelectorAll('i');
            stars.forEach(star => {
                star.addEventListener('click', () => {
                    const rating = parseInt(star.getAttribute('data-rating'));

                    stars.forEach((s, index) => {
                        if (index < rating) {
                            s.classList.remove('fa-regular');
                            s.classList.add('fa-solid', 'text-yellow-400');
                        } else {
                            s.classList.remove('fa-solid', 'text-yellow-400');
                            s.classList.add('fa-regular');
                        }
                    });
                });
            });
        }

        // 搜索建议显示/隐藏
        const searchInput = document.querySelector('input[placeholder="搜索情侣商品..."]');
        const searchSuggestions = document.getElementById('searchSuggestions');

        if (searchInput && searchSuggestions) {
            searchInput.addEventListener('focus', () => {
                searchSuggestions.classList.remove('invisible', 'opacity-0', '-translate-y-2');
                searchSuggestions.classList.add('visible', 'opacity-100', 'translate-y-0');
            });

            searchInput.addEventListener('blur', () => {
                setTimeout(() => {
                    searchSuggestions.classList.add('invisible', 'opacity-0', '-translate-y-2');
                    searchSuggestions.classList.remove('visible', 'opacity-100', 'translate-y-0');
                }, 200);
            });
        }
    });
</script>
{% endblock %}