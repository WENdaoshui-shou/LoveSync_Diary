{% extends 'mall/mall_base.html' %}

{% block title %}评价商品 - LoveSync{% endblock %}

{% block extra_css %}
<style type="text/tailwindcss">
  @layer utilities {
        .review-card {
            transition: all 0.3s ease;
        }
        .review-card:hover {
            box-shadow: 0 10px 25px -5px rgba(255, 107, 139, 0.1), 0 10px 10px -5px rgba(255, 107, 139, 0.04);
        }
        .star-rating {
            display: inline-flex;
            gap: 4px;
        }
        .star {
            cursor: pointer;
            color: #d1d5db;
            font-size: 20px;
        }
        .star.filled {
            color: #f59e0b;
        }
    }
</style>
{% endblock %}

{% block breadcrumb_items %}
<li class="inline-flex items-center">
  <a href="{% url 'mall:order_list' %}" class="text-gray-500 hover:text-primary text-sm font-medium">
    <i class="fa-solid fa-chevron-right text-gray-400 mx-2 text-xs"></i>
    我的订单
  </a>
</li>
<li class="inline-flex items-center">
  <a href="{% url 'mall:order_detail' order.order_number %}" class="text-gray-500 hover:text-primary text-sm font-medium">
    <i class="fa-solid fa-chevron-right text-gray-400 mx-2 text-xs"></i>
    订单详情
  </a>
</li>
<li>
  <div class="flex items-center">
    <i class="fa-solid fa-chevron-right text-gray-400 mx-2 text-xs"></i>
    <span class="text-neutral-800 font-medium text-sm text-primary">评价商品</span>
  </div>
</li>
{% endblock %}

{% block content_body %}
<div class="py-8">

  <!-- 评价标题 -->
  <div class="bg-white rounded-xl shadow-sm p-6 mb-8 review-card">
    <h2 class="text-xl font-bold mb-2">评价商品</h2>
    <p class="text-gray-500">订单编号：{{ order.order_number }}</p>
  </div>

  <!-- 评价表单 -->
  <div class="bg-white rounded-xl shadow-sm p-6 mb-8 review-card">
    <form method="post">
      {% csrf_token %}
      
      <div class="space-y-8">
        {% for item in order_items %}
        <div class="border-b border-gray-100 pb-6 last:border-0">
          <div class="flex items-start mb-4">
            {% if item.product.main_image and item.product.main_image.url %}
            <img src="{{ item.product.main_image.url }}" alt="{{ item.product.name }}"
              class="w-20 h-20 object-cover rounded-lg mr-4">
            {% else %}
            <img src="https://picsum.photos/id/26/200/200" alt="{{ item.product.name }}"
              class="w-20 h-20 object-cover rounded-lg mr-4">
            {% endif %}
            <div class="flex-1">
              <h3 class="font-medium text-gray-900 mb-1">{{ item.product.name }}</h3>
              {% if item.sku %}
              <p class="text-sm text-gray-500 mb-1">规格：{{ item.sku.name }}</p>
              {% endif %}
              <p class="text-sm text-gray-500">数量：{{ item.quantity }}</p>
            </div>
          </div>

          <!-- 评分 -->
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">商品评分</label>
            <div class="star-rating">
              {% for i in "12345" %}
              <i class="fa-solid fa-star star" data-rating="{{ i }}"></i>
              {% endfor %}
            </div>
            <input type="hidden" name="rating_{{ item.id }}" id="rating_{{ item.id }}" value="5">
          </div>

          <!-- 评价内容 -->
          <div class="mb-4">
            <label for="comment_{{ item.id }}" class="block text-sm font-medium text-gray-700 mb-2">评价内容</label>
            <textarea id="comment_{{ item.id }}" name="comment_{{ item.id }}" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" placeholder="请输入您的评价..."></textarea>
          </div>
        </div>
        {% endfor %}
      </div>

      <!-- 提交按钮 -->
      <div class="mt-8 flex justify-center">
        <button type="submit" class="px-8 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors flex items-center justify-center">
          <i class="fa-solid fa-check mr-2"></i>提交评价
        </button>
      </div>
    </form>
  </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // 评分功能
    const starRatings = document.querySelectorAll('.star-rating');
    
    starRatings.forEach(rating => {
      const stars = rating.querySelectorAll('.star');
      const input = rating.nextElementSibling;
      
      stars.forEach(star => {
        star.addEventListener('click', function() {
          const rating = this.getAttribute('data-rating');
          
          // 更新星星状态
          stars.forEach((s, index) => {
            if (index < rating) {
              s.classList.add('filled');
            } else {
              s.classList.remove('filled');
            }
          });
          
          // 更新隐藏输入值
          input.value = rating;
        });
      });
    });
  });
</script>
{% endblock %}