{% extends 'base.html' %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
<style>
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(8px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-fade-in {
        animation: fadeIn 0.3s ease-out forwards;
    }

    .rank-badge {
        position: relative;
        overflow: hidden;
    }

    .rank-badge::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.6s;
    }

    .rank-badge:hover::after {
        left: 100%;
    }

    .post-card {
        transition: all 0.3s ease;
    }

    .post-card:hover {
        transform: translateY(-2px);
    }

    .time-ago {
        transition: color 0.2s ease;
    }

    .time-ago:hover {
        color: #4F46E5;
    }
</style>
{% endblock %}

{% block content %}
<!-- ä¸»å†…å®¹åŒº -->
<div class="flex-grow pt-24 pb-16 relative z-10">
    <div class="container mx-auto px-4">
        <!-- æ’è¡Œæ¦œåˆ—è¡¨ -->
        <div class="max-w-4xl mx-auto">
            {% if hot_posts_with_rank %}
            <div class="space-y-5">
                {% for item in hot_posts_with_rank %}
                {% with post=item.post rank=item.rank %}
                <div class="post-card flex flex-col sm:flex-row items-start sm:items-center p-4 rounded-xl transition-all hover:shadow-lg {% if rank == 1 %}bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 animate-fade-in{% elif rank == 2 %}bg-gradient-to-r from-gray-50 to-slate-50 border border-gray-200 animate-fade-in{% elif rank == 3 %}bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200 animate-fade-in{% else %}bg-white border border-neutral-200 hover:border-primary/20{% endif %}"style="animation-delay: {% if rank <= 3 %}{{ item.rank_times_100 }}ms{% endif %}">
                    <!-- æ’ååºå· -->
                    <div class="flex-shrink-0 mb-4 sm:mb-0 sm:mr-5">
                        {% if rank <= 3 %} <div
                            class="rank-badge w-10 h-10 flex items-center justify-center font-bold text-white rounded-full {% if rank == 1 %}bg-yellow-500{% elif rank == 2 %}bg-gray-400{% else %}bg-amber-600{% endif %} shadow-md">
                            {{ rank }}
                            {% if rank == 1 %}
                            <i class="fa-solid fa-crown ml-1 text-xs"></i>
                            {% elif rank == 2 %}
                            <i class="fa-solid fa-medal ml-1 text-xs"></i>
                            {% else %}
                            <i class="fa-solid fa-award ml-1 text-xs"></i>
                            {% endif %}
                    </div>
                    {% else %}
                    <div
                        class="w-10 h-10 flex items-center justify-center font-bold text-neutral-600 bg-neutral-100 rounded-full hover:bg-neutral-200 transition-colors">
                        {{ rank }}
                    </div>
                    {% endif %}
                </div>

                <!-- åŠ¨æ€å†…å®¹ -->
                <div class="flex-1 min-w-0">
                    <!-- æ ‡é¢˜ -->
                    <h3 class="font-semibold text-neutral-800 mb-3 line-clamp-2">
                        <a href="{% url 'moment_web:moment_share' post.id %}"
                            class="hover:text-primary hover:underline transition-colors duration-200">{{ post.content }}</a>
                    </h3>

                    <!-- ä½œè€…ä¿¡æ¯ -->
                    <div class="flex items-center text-sm text-neutral-500 mb-3">
                        <a href="{% url 'user:user_profile' post.user.username %}"
                            class="flex items-center hover:text-primary transition-colors duration-200">
                            {% if post.user.profile and post.user.profile.userAvatar %}
                            <div class="w-6 h-6 rounded-full overflow-hidden mr-2 border border-primary/20">
                                <img src="{{ post.user.profile.userAvatar.url }}" alt="{{ post.user.username }}"
                                    class="w-full h-full object-cover"
                                    onerror="this.onerror=null; this.src='/static/images/default-avatar.png';">
                            </div>
                            {% else %}
                            <div
                                class="w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center mr-2 text-primary">
                                <i class="fa-solid fa-user text-xs"></i>
                            </div>
                            {% endif %}
                            <span class="font-medium">{{ post.user.name }}</span>
                        </a>
                        <span class="mx-2">â€¢</span>
                        <span class="time-ago" data-time="{{ post.created_at|date:'Y-m-d H:i:s' }}">{{
                            post.created_at|date:"Y-m-d H:i"|default:"æœªçŸ¥æ—¶é—´" }}</span>
                    </div>

                    <!-- çƒ­åº¦å€¼ -->
                    <div class="flex flex-wrap items-center text-sm gap-4">
                        <div class="flex items-center text-red-500" title="çƒ­åº¦: ç‚¹èµÃ—2 + è¯„è®ºÃ—3 + æµè§ˆÃ—1">
                            <span class="mr-1">ğŸ”¥</span>
                            <span>çƒ­åº¦ {{ post.get_hot_score }}</span>
                        </div>
                        <div class="flex items-center text-rose-500" title="ç‚¹èµæ•°">
                            <span class="mr-1">â¤ï¸</span>
                            <span>{{ post.likes }}</span>
                        </div>
                        <div class="flex items-center text-blue-500" title="è¯„è®ºæ•°">
                            <span class="mr-1">ğŸ’¬</span>
                            <span>{{ post.comments }}</span>
                        </div>
                        <div class="flex items-center text-slate-500" title="æµè§ˆæ•°">
                            <span class="mr-1">ğŸ‘ï¸</span>
                            <span>{{ post.view_count }}</span>
                        </div>
                    </div>
                </div>
            </div>
            {% endwith %}
            {% endfor %}
        </div>

        <!-- åº•éƒ¨ä¿¡æ¯ -->
        <div class="text-center mt-10 text-neutral-500 text-sm">
            <p>æ•°æ®æ›´æ–°æ—¶é—´: {{ request.user.last_login }}</p>
        </div>
        {% else %}
        <!-- ç©ºçŠ¶æ€ -->
        <div class="text-center py-20 bg-neutral-50 rounded-xl border border-dashed border-neutral-200">
            <div class="text-6xl mb-4">ğŸ”¥</div>
            <h3 class="text-xl font-medium text-neutral-600 mb-3">æš‚æ— çƒ­é—¨åŠ¨æ€</h3>
            <p class="text-neutral-500 mb-6">å¿«æ¥å‘å¸ƒç¬¬ä¸€æ¡åŠ¨æ€ï¼Œæˆä¸ºç¤¾åŒºçš„ç„¦ç‚¹å§ï¼</p>
            <a href="{% url 'moments' %}"
                class="inline-block bg-primary text-white px-6 py-3 rounded-lg hover:bg-primary/90 transition-colors duration-300 shadow-md hover:shadow-lg">
                å‘å¸ƒåŠ¨æ€
            </a>
        </div>
        {% endif %}
    </div>
</div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // æ—¶é—´æ ¼å¼åŒ–å‡½æ•°
    function formatTimeAgo(timestamp) {
        const now = new Date();
        const past = new Date(timestamp);
        const diffInSeconds = Math.floor((now - past) / 1000);

        if (diffInSeconds < 60) {
            return 'åˆšåˆš';
        } else if (diffInSeconds < 3600) {
            const minutes = Math.floor(diffInSeconds / 60);
            return `${minutes}åˆ†é’Ÿå‰`;
        } else if (diffInSeconds < 86400) {
            const hours = Math.floor(diffInSeconds / 3600);
            return `${hours}å°æ—¶å‰`;
        } else if (diffInSeconds < 604800) {
            const days = Math.floor(diffInSeconds / 86400);
            return `${days}å¤©å‰`;
        } else {
            return past.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }
    }

    // é¡µé¢åŠ è½½å®Œæˆåå¤„ç†æ—¶é—´æ˜¾ç¤º
    document.addEventListener('DOMContentLoaded', function () {
        const timeElements = document.querySelectorAll('.time-ago');
        timeElements.forEach(element => {
            const timestamp = element.getAttribute('data-time');
            if (timestamp) {
                element.textContent = formatTimeAgo(timestamp);
            }
        });

        // ä¸ºæ’åå¾½ç« æ·»åŠ æ‚¬åœæ•ˆæœ
        const rankBadges = document.querySelectorAll('.rank-badge');
        rankBadges.forEach(badge => {
            badge.addEventListener('mouseenter', function () {
                this.style.transform = 'scale(1.05)';
                this.style.transition = 'transform 0.2s ease';
            });

            badge.addEventListener('mouseleave', function () {
                this.style.transform = 'scale(1)';
            });
        });
    });
</script>
{% endblock %}