{% extends 'base.html' %}

{% block title %}æˆå°±ç³»ç»Ÿ - LoveSync{% endblock %}

{% block extra_css %}
<style>
    .achievement-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .achievement-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
    }

    .achievement-card.unlocked {
        border-left: 5px solid #2ecc71;
    }

    .achievement-card.locked {
        border-left: 5px solid #bdc3c7;
        opacity: 0.7;
    }

    .achievement-icon {
        font-size: 3rem;
        margin-bottom: 15px;
        text-align: center;
    }

    .achievement-card.unlocked .achievement-icon {
        color: #2ecc71;
    }

    .achievement-card.locked .achievement-icon {
        color: #bdc3c7;
    }

    .achievement-title {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 10px;
        text-align: center;
    }

    .achievement-description {
        color: #777;
        margin-bottom: 15px;
        text-align: center;
        font-size: 0.95rem;
    }

    .achievement-progress {
        margin-top: 15px;
    }

    .progress-bar {
        width: 100%;
        height: 10px;
        background-color: #ecf0f1;
        border-radius: 5px;
        overflow: hidden;
        margin-bottom: 5px;
    }

    .progress-fill {
        height: 100%;
        background-color: #3498db;
        border-radius: 5px;
        transition: width 0.3s ease;
    }

    .progress-text {
        font-size: 0.85rem;
        color: #95a5a6;
        text-align: right;
    }

    .achievement-date {
        font-size: 0.8rem;
        color: #95a5a6;
        text-align: center;
        margin-top: 10px;
    }

    .achievement-card.locked .achievement-date {
        display: none;
    }

    .filter-tabs {
        display: flex;
        justify-content: center;
        margin-bottom: 30px;
        gap: 10px;
    }

    .filter-tab {
        padding: 10px 20px;
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.95rem;
    }

    .filter-tab.active {
        background-color: #e74c3c;
        color: white;
        border-color: #e74c3c;
    }

    .filter-tab:hover {
        background-color: #f8f9fa;
    }

    .filter-tab.active:hover {
        background-color: #c0392b;
    }

    .stats-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background-color: white;
        padding: 25px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        color: #e74c3c;
        margin-bottom: 5px;
    }

    .stat-label {
        font-size: 1rem;
        color: #777;
    }

    @media (max-width: 768px) {
        .achievements-grid {
            grid-template-columns: 1fr;
        }

        .stats-summary {
            grid-template-columns: repeat(2, 1fr);
        }

        .filter-tabs {
            flex-wrap: wrap;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- ä¸»å†…å®¹åŒº -->
<main class="flex-grow pt-32 pb-16 relative z-10">
    <div class="container mx-auto px-4">
        <header class="text-center mb-10 animate-fade-in">
            <h1 class="text-3xl font-bold text-neutral-900 mb-2">ğŸ† æˆå°±ç³»ç»Ÿ</h1>
            <p class="text-neutral-600">è§£é”å±äºä½ ä»¬çš„çˆ±æƒ…æˆå°±ï¼Œè®°å½•ç¾å¥½ç¬é—´</p>
        </header>

        <div class="stats-summary">
            <div class="stat-card animate-slide-up" style="animation-delay: 0.1s">
                <div class="stat-number" id="totalAchievements">0</div>
                <div class="stat-label">æ€»æˆå°±æ•°</div>
            </div>
            <div class="stat-card animate-slide-up" style="animation-delay: 0.2s">
                <div class="stat-number" id="unlockedAchievements">0</div>
                <div class="stat-label">å·²è§£é”</div>
            </div>
            <div class="stat-card animate-slide-up" style="animation-delay: 0.3s">
                <div class="stat-number" id="completionRate">0%</div>
                <div class="stat-label">å®Œæˆç‡</div>
            </div>
            <div class="stat-card animate-slide-up" style="animation-delay: 0.4s">
                <div class="stat-number" id="recentAchievements">0</div>
                <div class="stat-label">æœ€è¿‘è§£é”</div>
            </div>
        </div>

        <div class="filter-tabs">
            <div class="filter-tab active" data-filter="all">å…¨éƒ¨æˆå°±</div>
            <div class="filter-tab" data-filter="unlocked">å·²è§£é”</div>
            <div class="filter-tab" data-filter="locked">æœªè§£é”</div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 achievements-grid" id="achievementsGrid">
            <!-- æˆå°±å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>
</main>
{% endblock %}

{% block extra_js %}
<script>
    // æˆå°±æ•°æ®
    let achievements = [];

    // åŠ è½½æˆå°±æ•°æ®
    function loadAchievementsData() {
        fetch('/user/achievements/data/')
            .then(response => {
                if (!response.ok) {
                    throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
                }
                return response.json();
            })
            .then(data => {
                achievements = data.achievements;
                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                updateStats(data.stats);
                // æ¸²æŸ“æˆå°±
                renderAchievements('all');
            })
            .catch(error => {
                console.error('åŠ è½½æˆå°±æ•°æ®å¤±è´¥:', error);
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                const grid = document.getElementById('achievementsGrid');
                grid.innerHTML = `
                    <div class="col-span-full text-center py-12 text-neutral-500">
                        <i class="fa-solid fa-exclamation-circle text-4xl mb-4 opacity-50"></i>
                        <p>åŠ è½½æˆå°±æ•°æ®å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</p>
                    </div>
                `;
            });
    }

    // æ¸²æŸ“æˆå°±å¡ç‰‡
    function renderAchievements(filter = 'all') {
        const grid = document.getElementById('achievementsGrid');
        let filteredAchievements = achievements;

        if (filter === 'unlocked') {
            filteredAchievements = achievements.filter(a => a.unlocked);
        } else if (filter === 'locked') {
            filteredAchievements = achievements.filter(a => !a.unlocked);
        }

        grid.innerHTML = filteredAchievements.map(achievement => `
            <div class="achievement-card ${achievement.unlocked ? 'unlocked' : 'locked'} bg-white rounded-xl shadow-md p-6 animate-slide-up">
                <div class="achievement-icon">${achievement.icon}</div>
                <h3 class="achievement-title">${achievement.title}</h3>
                <p class="achievement-description">${achievement.description}</p>
                ${!achievement.unlocked ? `
                    <div class="achievement-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${achievement.progress}%"></div>
                        </div>
                        <div class="progress-text">${achievement.progress}% å®Œæˆ</div>
                    </div>
                ` : ''}
                ${achievement.unlocked ? `<div class="achievement-date">è§£é”äº ${achievement.date}</div>` : ''}
            </div>
        `).join('');
    }

    // æ›´æ–°ç»Ÿè®¡æ•°æ®
    function updateStats(stats) {
        if (stats) {
            document.getElementById('totalAchievements').textContent = stats.totalAchievements;
            document.getElementById('unlockedAchievements').textContent = stats.unlockedAchievements;
            document.getElementById('completionRate').textContent = `${stats.completionRate}%`;
            document.getElementById('recentAchievements').textContent = stats.recentAchievements;
        } else {
            const total = achievements.length;
            const unlocked = achievements.filter(a => a.unlocked).length;
            const completionRate = Math.round((unlocked / total) * 100);
            const recent = achievements.filter(a => a.unlocked).slice(-3).length;

            document.getElementById('totalAchievements').textContent = total;
            document.getElementById('unlockedAchievements').textContent = unlocked;
            document.getElementById('completionRate').textContent = `${completionRate}%`;
            document.getElementById('recentAchievements').textContent = recent;
        }
    }

    // è¿‡æ»¤æ ‡ç­¾ç‚¹å‡»äº‹ä»¶
    document.querySelectorAll('.filter-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            // ç§»é™¤æ‰€æœ‰activeç±»
            document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
            // æ·»åŠ activeç±»åˆ°å½“å‰ç‚¹å‡»çš„æ ‡ç­¾
            tab.classList.add('active');
            // æ¸²æŸ“å¯¹åº”è¿‡æ»¤æ¡ä»¶çš„æˆå°±
            renderAchievements(tab.dataset.filter);
        });
    });

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function () {
        loadAchievementsData();
    });
</script>
{% endblock %}