{% extends 'base.html' %}

{% block title %}LoveSync - 私信列表{% endblock %}

{% block content %}
<!-- 背景装饰元素 -->
<div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
    <div class="absolute -top-40 -left-40 w-80 h-80 bg-primary/10 rounded-full filter blur-3xl float-animation">
    </div>
    <div class="absolute -bottom-20 -right-20 w-80 h-80 bg-secondary/10 rounded-full filter blur-3xl float-animation"
        style="animation-delay: -2s;"></div>
    <div class="absolute top-1/3 right-1/4 w-40 h-40 bg-primary/5 rounded-full filter blur-2xl float-animation"
        style="animation-delay: -4s;"></div>
</div>

<!-- 主内容区 -->
<main class="flex-grow pt-24 pb-16 relative z-10">
    <div class="container mx-auto px-4">
        <!-- 页面标题 -->
        <div class="bg-white rounded-xl shadow-lg p-6 hover-scale">
            <h2 class="text-2xl font-bold text-neutral-900 mb-4">私信列表</h2>
            <p class="text-neutral-500 mb-6">查看和管理你的私信会话</p>
        </div>

        <!-- 私信会话列表 -->
        <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
            <div class="overflow-hidden">
                <!-- 会话列表 -->
                <div class="space-y-4">
                    {% for conversation in conversations %}
                    <div class="p-4 border-b border-neutral-200 hover:bg-neutral-50 transition-colors rounded-lg cursor-pointer"
                        onclick="window.location.href='{% url 'message:private_chat_detail' conversation.partner.id %}'">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 rounded-full overflow-hidden">
                                    <img src="{{ conversation.partner.profile.userAvatar.url }}"
                                        alt="{{ conversation.partner.name }}" class="w-full h-full object-cover">
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <h3 class="font-semibold text-neutral-900">{{ conversation.partner.name }}</h3>
                                        <span class="text-neutral-500 text-sm">{{
                                            conversation.last_message.message.create_time|date:"Y-m-d H:i" }}</span>
                                    </div>
                                    <p class="text-neutral-600 truncate mt-1">{{
                                        conversation.last_message.message.content }}</p>
                                </div>
                            </div>
                            {% if conversation.unread_count > 0 %}
                            <span class="bg-primary text-white text-xs font-bold px-2 py-1 rounded-full">
                                {{ conversation.unread_count }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center py-12 text-neutral-500">
                        <i class="fa-solid fa-envelope-open text-4xl mb-4 opacity-50"></i>
                        <p>暂无私信会话</p>
                        <a href="{% url 'message:send_private_message' %}"
                            class="mt-4 inline-flex items-center px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                            <i class="fa-solid fa-paper-plane mr-2"></i>发送私信
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block extra_js %}
<script>
    // 页面加载完成后获取未读消息数量
    document.addEventListener('DOMContentLoaded', function () {
        // 可以在这里添加一些交互效果
    });
</script>
{% endblock %}